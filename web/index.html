<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PropelAI - RFP Intelligence Platform</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a24;
            --bg-card: #16161f;
            --border-color: #2a2a3a;
            --border-accent: #3a3a4a;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --accent-blue: #4f8cff;
            --accent-blue-dim: #3a6acc;
            --accent-green: #34d399;
            --accent-amber: #fbbf24;
            --accent-red: #f87171;
            --accent-purple: #a78bfa;
            --gradient-blue: linear-gradient(135deg, #4f8cff 0%, #7c3aed 100%);
            --gradient-card: linear-gradient(180deg, rgba(79, 140, 255, 0.05) 0%, transparent 100%);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-accent); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
        
        .app-container { display: flex; min-height: 100vh; }
        
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        
        .logo { padding: 24px; border-bottom: 1px solid var(--border-color); }
        
        .logo h1 {
            font-size: 22px;
            font-weight: 700;
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .logo span {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: block;
            margin-top: 4px;
        }
        
        .nav-section { padding: 16px 12px; flex: 1; }
        
        .nav-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            padding: 8px 12px;
            margin-bottom: 4px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            margin-bottom: 2px;
        }
        
        .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .nav-item.active { background: rgba(79, 140, 255, 0.15); color: var(--accent-blue); }
        .nav-item.disabled { opacity: 0.5; cursor: not-allowed; }
        .nav-item svg { width: 18px; height: 18px; opacity: 0.8; }
        
        .main-content { flex: 1; margin-left: 260px; padding: 32px 40px; background: var(--bg-primary); }
        
        .page-header { margin-bottom: 32px; }
        .page-header h2 { font-size: 28px; font-weight: 600; letter-spacing: -0.5px; margin-bottom: 8px; }
        .page-header p { color: var(--text-secondary); font-size: 15px; }
        
        .upload-zone {
            border: 2px dashed var(--border-accent);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            background: var(--gradient-card);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .upload-zone:hover { border-color: var(--accent-blue); background: rgba(79, 140, 255, 0.05); }
        .upload-zone.dragging { border-color: var(--accent-blue); background: rgba(79, 140, 255, 0.1); transform: scale(1.01); }
        
        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-icon svg { width: 28px; height: 28px; color: var(--accent-blue); }
        .upload-zone h3 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .upload-zone p { color: var(--text-secondary); font-size: 14px; margin-bottom: 16px; }
        
        .file-types { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        
        .file-type {
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
        }
        
        .btn-primary { background: var(--gradient-blue); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(79, 140, 255, 0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--border-color); }
        .btn-ghost { background: transparent; color: var(--text-secondary); padding: 8px; }
        .btn-ghost:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .btn svg { width: 18px; height: 18px; }
        
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .card-title { font-size: 16px; font-weight: 600; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .stat-card .label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .stat-card .value { font-size: 32px; font-weight: 700; letter-spacing: -1px; }
        .stat-card.blue .value { color: var(--accent-blue); }
        .stat-card.green .value { color: var(--accent-green); }
        .stat-card.amber .value { color: var(--accent-amber); }
        .stat-card.red .value { color: var(--accent-red); }
        
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 14px 16px; border-bottom: 1px solid var(--border-color); }
        th { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); font-weight: 600; background: var(--bg-tertiary); position: sticky; top: 0; }
        th:first-child { border-radius: 8px 0 0 0; }
        th:last-child { border-radius: 0 8px 0 0; }
        tr:hover td { background: rgba(79, 140, 255, 0.03); }
        td { font-size: 14px; }
        
        .req-id { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--accent-blue); }
        .req-text { max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        .badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-blue { background: rgba(79, 140, 255, 0.15); color: var(--accent-blue); }
        .badge-green { background: rgba(52, 211, 153, 0.15); color: var(--accent-green); }
        .badge-amber { background: rgba(251, 191, 36, 0.15); color: var(--accent-amber); }
        .badge-red { background: rgba(248, 113, 113, 0.15); color: var(--accent-red); }
        .badge-purple { background: rgba(167, 139, 250, 0.15); color: var(--accent-purple); }
        .badge-gray { background: var(--bg-tertiary); color: var(--text-secondary); }
        
        .priority-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .priority-high { background: var(--accent-red); }
        .priority-medium { background: var(--accent-amber); }
        .priority-low { background: var(--accent-green); }
        
        .progress-bar { height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gradient-blue); border-radius: 3px; transition: width 0.5s ease; }
        
        .file-list { display: flex; flex-direction: column; gap: 8px; margin-top: 24px; }
        .file-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color); }
        .file-icon { width: 40px; height: 40px; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .file-icon svg { width: 20px; height: 20px; color: var(--accent-blue); }
        .file-info { flex: 1; }
        .file-name { font-weight: 500; font-size: 14px; }
        .file-meta { font-size: 12px; color: var(--text-muted); }
        .file-status { display: flex; align-items: center; gap: 8px; }
        
        .tabs { display: flex; gap: 4px; background: var(--bg-tertiary); padding: 4px; border-radius: 10px; margin-bottom: 24px; }
        .tab { padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; border: none; background: transparent; font-family: inherit; }
        .tab:hover { color: var(--text-primary); }
        .tab.active { background: var(--bg-card); color: var(--text-primary); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        
        .processing-overlay { position: fixed; inset: 0; background: rgba(10, 10, 15, 0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(8px); }
        .processing-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 48px 64px; text-align: center; max-width: 480px; }
        .spinner { width: 48px; height: 48px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 24px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .processing-card h3 { font-size: 20px; margin-bottom: 8px; }
        .processing-card p { color: var(--text-secondary); margin-bottom: 24px; }
        
        .actions-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .search-box { display: flex; align-items: center; gap: 8px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 16px; width: 300px; }
        .search-box input { flex: 1; background: transparent; border: none; color: var(--text-primary); font-size: 14px; outline: none; font-family: inherit; }
        .search-box input::placeholder { color: var(--text-muted); }
        .search-box svg { width: 18px; height: 18px; color: var(--text-muted); }
        .filter-group { display: flex; gap: 8px; }
        
        select { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 16px; color: var(--text-primary); font-size: 14px; font-family: inherit; cursor: pointer; outline: none; }
        select:focus { border-color: var(--accent-blue); }
        
        .sidebar-footer { padding: 16px 24px; border-top: 1px solid var(--border-color); }
        .sidebar-footer p { font-size: 12px; color: var(--text-muted); }
        
        .api-status { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--bg-tertiary); border-radius: 6px; margin-bottom: 8px; }
        .api-dot { width: 8px; height: 8px; border-radius: 50%; }
        .api-dot.connected { background: var(--accent-green); }
        .api-dot.disconnected { background: var(--accent-red); }
        
        .error-banner { background: rgba(248, 113, 113, 0.1); border: 1px solid var(--accent-red); border-radius: 8px; padding: 16px; margin-bottom: 24px; color: var(--accent-red); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.3s ease forwards; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // API Configuration
        const API_BASE = window.location.origin + '/api';
        
        // API Client
        const api = {
            async health() {
                const res = await fetch(`${API_BASE}/health`);
                return res.json();
            },
            
            async createRFP(data) {
                const res = await fetch(`${API_BASE}/rfp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return res.json();
            },
            
            async uploadFiles(rfpId, files) {
                const formData = new FormData();
                files.forEach(f => formData.append('files', f));
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/upload`, {
                    method: 'POST',
                    body: formData
                });
                return res.json();
            },
            
            async processRFP(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/process`, { method: 'POST' });
                return res.json();
            },
            
            async processRFPSemantic(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/process-semantic`, { method: 'POST' });
                return res.json();
            },
            
            async processRFPBestPractices(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/process-best-practices`, { method: 'POST' });
                return res.json();
            },
            
            async getStatus(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/status`);
                return res.json();
            },
            
            async getRFP(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}`);
                return res.json();
            },
            
            async getRequirements(rfpId, params = {}) {
                const query = new URLSearchParams(params).toString();
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/requirements?${query}`);
                return res.json();
            },
            
            async exportExcel(rfpId) {
                window.open(`${API_BASE}/rfp/${rfpId}/export?format=xlsx`, '_blank');
            },
            
            async getAmendments(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/amendments`);
                return res.json();
            },
            
            async getOutline(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/outline`);
                return res.json();
            },
            
            async exportOutline(rfpId) {
                window.open(`${API_BASE}/rfp/${rfpId}/outline/export`, '_blank');
            },
            
            async generateOutline(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/outline`, { method: 'POST' });
                return res.json();
            },

            // OASIS+ API Methods
            async oasisHealth() {
                const res = await fetch(`${API_BASE}/oasis/health`);
                return res.json();
            },

            async oasisCreateProposal(data) {
                const res = await fetch(`${API_BASE}/oasis/proposals`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return res.json();
            },

            async oasisListProposals() {
                const res = await fetch(`${API_BASE}/oasis/proposals`);
                return res.json();
            },

            async oasisGetProposal(proposalId) {
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}`);
                return res.json();
            },

            async oasisUploadJP1(proposalId, file) {
                const formData = new FormData();
                formData.append('file', file);
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}/jp1`, {
                    method: 'POST',
                    body: formData
                });
                return res.json();
            },

            async oasisAddProject(proposalId, projectData) {
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });
                return res.json();
            },

            async oasisUploadProjectDocs(proposalId, projectId, files) {
                const formData = new FormData();
                files.forEach(f => formData.append('files', f));
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}/projects/${projectId}/documents`, {
                    method: 'POST',
                    body: formData
                });
                return res.json();
            },

            async oasisScore(proposalId, domain, projectIds = null) {
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}/score`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain, project_ids: projectIds })
                });
                return res.json();
            },

            async oasisOptimize(proposalId, domain, maxProjects = 5) {
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}/optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain, max_projects: maxProjects })
                });
                return res.json();
            },

            async oasisGetScorecard(proposalId, domain) {
                const res = await fetch(`${API_BASE}/oasis/proposals/${proposalId}/scorecard?domain=${domain}`);
                return res.json();
            },

            async oasisExportBundle(proposalId, domain) {
                window.open(`${API_BASE}/oasis/proposals/${proposalId}/export?domain=${domain}`, '_blank');
            }
        };
        
        // Icon component
        function Icon({ name, size = 20 }) {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current && lucide.icons[name]) {
                    ref.current.innerHTML = '';
                    const icon = lucide.createElement(lucide.icons[name]);
                    ref.current.appendChild(icon);
                }
            }, [name]);
            return <span ref={ref} style={{ display: 'inline-flex', width: size, height: size }} />;
        }
        
        // Dashboard View - NEW Landing Page
        function DashboardView({ onNewRFP, onNewOASIS, onOpenProject, recentProjects, apiConnected }) {
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Welcome to PropelAI</h2>
                        <p>RFP Intelligence Platform - Extract requirements, build compliance matrices, and win more contracts</p>
                    </div>

                    {/* Quick Actions */}
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 20, marginBottom: 40 }}>
                        <div
                            className="card"
                            style={{ cursor: 'pointer', transition: 'all 0.2s', border: '2px solid transparent' }}
                            onClick={onNewRFP}
                            onMouseOver={e => e.currentTarget.style.borderColor = 'var(--accent-blue)'}
                            onMouseOut={e => e.currentTarget.style.borderColor = 'transparent'}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 16 }}>
                                <div style={{
                                    width: 48, height: 48,
                                    background: 'rgba(79, 140, 255, 0.15)',
                                    borderRadius: 12,
                                    display: 'flex', alignItems: 'center', justifyContent: 'center'
                                }}>
                                    <Icon name="FileText" size={24} />
                                </div>
                                <div>
                                    <h3 style={{ fontSize: 18, marginBottom: 4 }}>New RFP Analysis</h3>
                                    <span style={{ fontSize: 12, color: 'var(--text-muted)' }}>Standard UCF Format</span>
                                </div>
                            </div>
                            <p style={{ color: 'var(--text-secondary)', fontSize: 14 }}>
                                Upload NIH, DoD, VA, HHS, or other standard RFPs. Extract requirements and build compliance matrices.
                            </p>
                        </div>

                        <div
                            className="card"
                            style={{ cursor: 'pointer', transition: 'all 0.2s', border: '2px solid transparent' }}
                            onClick={onNewOASIS}
                            onMouseOver={e => e.currentTarget.style.borderColor = 'var(--accent-purple)'}
                            onMouseOut={e => e.currentTarget.style.borderColor = 'transparent'}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 16 }}>
                                <div style={{
                                    width: 48, height: 48,
                                    background: 'rgba(167, 139, 250, 0.15)',
                                    borderRadius: 12,
                                    display: 'flex', alignItems: 'center', justifyContent: 'center'
                                }}>
                                    <Icon name="Target" size={24} />
                                </div>
                                <div>
                                    <h3 style={{ fontSize: 18, marginBottom: 4 }}>OASIS+ Proposal</h3>
                                    <span style={{ fontSize: 12, color: 'var(--accent-green)' }}>NEW</span>
                                </div>
                            </div>
                            <p style={{ color: 'var(--text-secondary)', fontSize: 14 }}>
                                GSA OASIS+ self-scoring. Parse J.P-1 matrices, optimize project selection, generate Symphony bundles.
                            </p>
                        </div>

                        <div
                            className="card"
                            style={{ cursor: 'pointer', transition: 'all 0.2s', border: '2px solid transparent', opacity: apiConnected ? 1 : 0.5 }}
                            onClick={() => apiConnected && onOpenProject('library')}
                            onMouseOver={e => e.currentTarget.style.borderColor = 'var(--accent-green)'}
                            onMouseOut={e => e.currentTarget.style.borderColor = 'transparent'}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 16 }}>
                                <div style={{
                                    width: 48, height: 48,
                                    background: 'rgba(52, 211, 153, 0.15)',
                                    borderRadius: 12,
                                    display: 'flex', alignItems: 'center', justifyContent: 'center'
                                }}>
                                    <Icon name="Building" size={24} />
                                </div>
                                <div>
                                    <h3 style={{ fontSize: 18, marginBottom: 4 }}>Company Library</h3>
                                    <span style={{ fontSize: 12, color: 'var(--text-muted)' }}>Capabilities & Past Performance</span>
                                </div>
                            </div>
                            <p style={{ color: 'var(--text-secondary)', fontSize: 14 }}>
                                Upload capabilities statements, past performance, and resumes for enhanced proposal generation.
                            </p>
                        </div>
                    </div>

                    {/* Recent Projects */}
                    <div className="card">
                        <div className="card-header">
                            <h3 className="card-title">Recent Projects</h3>
                            {recentProjects.length > 0 && (
                                <button className="btn btn-ghost" onClick={() => {
                                    localStorage.removeItem('propelai_recent_projects');
                                    window.location.reload();
                                }}>
                                    Clear History
                                </button>
                            )}
                        </div>

                        {recentProjects.length === 0 ? (
                            <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-muted)' }}>
                                <Icon name="Folder" size={48} />
                                <p style={{ marginTop: 16 }}>No recent projects</p>
                                <p style={{ fontSize: 13, marginTop: 8 }}>Start a new RFP analysis to see it here</p>
                            </div>
                        ) : (
                            <div>
                                {recentProjects.map((project, idx) => (
                                    <div
                                        key={project.id || idx}
                                        style={{
                                            padding: 16,
                                            borderBottom: idx < recentProjects.length - 1 ? '1px solid var(--border-color)' : 'none',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: 16,
                                            cursor: 'pointer',
                                            transition: 'background 0.2s'
                                        }}
                                        onClick={() => onOpenProject(project)}
                                        onMouseOver={e => e.currentTarget.style.background = 'var(--bg-tertiary)'}
                                        onMouseOut={e => e.currentTarget.style.background = 'transparent'}
                                    >
                                        <div style={{
                                            width: 40, height: 40,
                                            background: project.type === 'oasis' ? 'rgba(167, 139, 250, 0.15)' : 'rgba(79, 140, 255, 0.15)',
                                            borderRadius: 8,
                                            display: 'flex', alignItems: 'center', justifyContent: 'center'
                                        }}>
                                            <Icon name={project.type === 'oasis' ? 'Target' : 'FileText'} size={20} />
                                        </div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: 500 }}>{project.name}</div>
                                            <div style={{ fontSize: 12, color: 'var(--text-muted)', marginTop: 2 }}>
                                                {project.type === 'oasis' ? 'OASIS+ Proposal' : 'RFP Analysis'} · {project.date}
                                            </div>
                                        </div>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                            {project.requirementsCount && (
                                                <span className="badge badge-blue">{project.requirementsCount} reqs</span>
                                            )}
                                            {project.score && (
                                                <span className="badge badge-purple">{project.score} pts</span>
                                            )}
                                            <span className={`badge badge-${project.status === 'completed' ? 'green' : project.status === 'processing' ? 'amber' : 'gray'}`}>
                                                {project.status || 'draft'}
                                            </span>
                                            <Icon name="ChevronRight" size={18} />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Quick Stats */}
                    <div style={{ marginTop: 32 }}>
                        <h3 style={{ fontSize: 14, color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: 1, marginBottom: 16 }}>
                            Platform Status
                        </h3>
                        <div className="stats-grid">
                            <div className="stat-card">
                                <div className="label">API Status</div>
                                <div className="value" style={{ color: apiConnected ? 'var(--accent-green)' : 'var(--accent-red)', fontSize: 20 }}>
                                    {apiConnected ? 'Connected' : 'Offline'}
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="label">Recent Projects</div>
                                <div className="value" style={{ fontSize: 20 }}>{recentProjects.length}</div>
                            </div>
                            <div className="stat-card">
                                <div className="label">Version</div>
                                <div className="value" style={{ fontSize: 20 }}>v3.0</div>
                            </div>
                            <div className="stat-card">
                                <div className="label">OASIS+ Module</div>
                                <div className="value" style={{ color: 'var(--accent-green)', fontSize: 20 }}>Active</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // OASIS+ Upload View Component
        function OASISUploadView({
            proposalId, setProposalId,
            jp1File, setJP1File,
            domains, setDomains,
            selectedDomain, setSelectedDomain,
            projects, setProjects,
            processing, setProcessing,
            status, setStatus,
            setScorecard,
            onCancel, onComplete,
            setError, saveToRecentProjects
        }) {
            const [contractorName, setContractorName] = useState('');
            const [businessSize, setBusinessSize] = useState('unrestricted');
            const [step, setStep] = useState(1);
            const jp1InputRef = useRef(null);
            const projectInputRef = useRef(null);

            const DOMAIN_OPTIONS = [
                { id: 'technical_engineering', name: 'Technical & Engineering', icon: 'Cpu' },
                { id: 'management_advisory', name: 'Management & Advisory', icon: 'Users' },
                { id: 'research_development', name: 'Research & Development', icon: 'FlaskConical' },
                { id: 'intelligence_services', name: 'Intelligence Services', icon: 'Shield' },
                { id: 'environmental', name: 'Environmental', icon: 'Leaf' },
                { id: 'logistics', name: 'Logistics', icon: 'Truck' },
                { id: 'enterprise_solutions', name: 'Enterprise Solutions', icon: 'Server' },
                { id: 'facilities', name: 'Facilities', icon: 'Building2' }
            ];

            // Step 1: Create proposal
            const handleCreateProposal = async () => {
                if (!contractorName.trim()) {
                    setError('Please enter contractor name');
                    return;
                }
                setProcessing(true);
                setStatus({ step: 'creating', message: 'Creating OASIS+ proposal...' });
                try {
                    const result = await api.oasisCreateProposal({
                        contractor_name: contractorName,
                        business_size: businessSize,
                        target_domains: []
                    });
                    setProposalId(result.proposal_id);
                    setStep(2);
                    setStatus({ step: '', message: '' });
                } catch (e) {
                    setError('Failed to create proposal: ' + e.message);
                } finally {
                    setProcessing(false);
                }
            };

            // Step 2: Upload J.P-1
            const handleJP1Upload = async (e) => {
                const file = e.target.files?.[0];
                if (!file) return;

                setJP1File(file);
                setProcessing(true);
                setStatus({ step: 'jp1', message: 'Parsing J.P-1 Qualifications Matrix...' });

                try {
                    const result = await api.oasisUploadJP1(proposalId, file);
                    if (result.success) {
                        setDomains(result.domains || []);
                        setStep(3);
                        setStatus({ step: '', message: '' });
                    } else {
                        setError('Failed to parse J.P-1: ' + (result.detail || 'Unknown error'));
                    }
                } catch (e) {
                    setError('Failed to upload J.P-1: ' + e.message);
                } finally {
                    setProcessing(false);
                }
            };

            // Step 4: Upload project documents
            const handleProjectUpload = async (e) => {
                const files = Array.from(e.target.files || []);
                if (files.length === 0) return;

                setProcessing(true);
                setStatus({ step: 'projects', message: `Processing ${files.length} document(s)...` });

                try {
                    // For simplicity, create one project per batch upload
                    const projectData = {
                        title: `Project ${projects.length + 1}`,
                        client_agency: 'TBD',
                        contract_number: `CONTRACT-${Date.now()}`,
                        start_date: '2020-01-01',
                        total_obligated_amount: 1000000,
                        scope_description: 'Uploaded project documents'
                    };

                    const projectResult = await api.oasisAddProject(proposalId, projectData);

                    // Upload documents to the project
                    await api.oasisUploadProjectDocs(proposalId, projectResult.project_id, files);

                    setProjects([...projects, {
                        ...projectResult,
                        files: files.map(f => f.name)
                    }]);

                    setStatus({ step: '', message: '' });
                } catch (e) {
                    setError('Failed to upload project: ' + e.message);
                } finally {
                    setProcessing(false);
                }
            };

            // Start scoring
            const handleStartScoring = async () => {
                if (!selectedDomain) {
                    setError('Please select a domain');
                    return;
                }
                if (projects.length === 0) {
                    setError('Please upload at least one project');
                    return;
                }

                setProcessing(true);
                setStatus({ step: 'scoring', message: 'Analyzing projects and finding evidence...' });

                try {
                    // Score all projects
                    await api.oasisScore(proposalId, selectedDomain);

                    setStatus({ step: 'optimizing', message: 'Optimizing project selection...' });

                    // Optimize selection
                    await api.oasisOptimize(proposalId, selectedDomain);

                    setStatus({ step: 'scorecard', message: 'Generating scorecard...' });

                    // Get scorecard
                    const scorecard = await api.oasisGetScorecard(proposalId, selectedDomain);
                    setScorecard(scorecard);

                    // Save to recent projects
                    saveToRecentProjects({
                        id: proposalId,
                        name: contractorName,
                        type: 'oasis',
                        date: new Date().toLocaleDateString(),
                        status: 'completed',
                        score: scorecard.total_score
                    });

                    onComplete();
                } catch (e) {
                    setError('Scoring failed: ' + e.message);
                } finally {
                    setProcessing(false);
                    setStatus({ step: '', message: '' });
                }
            };

            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>OASIS+ Self-Scoring Proposal</h2>
                        <p>Upload J.P-1 Matrix and project documents for automated scoring and optimization</p>
                    </div>

                    {/* Progress Steps */}
                    <div style={{ display: 'flex', gap: 8, marginBottom: 32 }}>
                        {['Setup', 'J.P-1 Matrix', 'Domain', 'Projects', 'Score'].map((label, idx) => (
                            <div key={idx} style={{ flex: 1, textAlign: 'center' }}>
                                <div style={{
                                    width: 32, height: 32,
                                    borderRadius: '50%',
                                    background: step > idx + 1 ? 'var(--accent-green)' : step === idx + 1 ? 'var(--accent-purple)' : 'var(--bg-tertiary)',
                                    color: step >= idx + 1 ? 'white' : 'var(--text-muted)',
                                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                                    margin: '0 auto 8px',
                                    fontWeight: 600, fontSize: 14
                                }}>
                                    {step > idx + 1 ? '✓' : idx + 1}
                                </div>
                                <div style={{ fontSize: 12, color: step === idx + 1 ? 'var(--text-primary)' : 'var(--text-muted)' }}>
                                    {label}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Step 1: Setup */}
                    {step === 1 && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Step 1: Proposal Setup</h3>
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                                <div>
                                    <label style={{ display: 'block', marginBottom: 8, fontWeight: 500 }}>Contractor Name</label>
                                    <input
                                        type="text"
                                        value={contractorName}
                                        onChange={e => setContractorName(e.target.value)}
                                        placeholder="Enter your company name"
                                        style={{
                                            width: '100%',
                                            padding: '12px 16px',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: 8,
                                            color: 'var(--text-primary)',
                                            fontSize: 14
                                        }}
                                    />
                                </div>
                                <div>
                                    <label style={{ display: 'block', marginBottom: 8, fontWeight: 500 }}>Business Size</label>
                                    <select
                                        value={businessSize}
                                        onChange={e => setBusinessSize(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '12px 16px',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: 8,
                                            color: 'var(--text-primary)',
                                            fontSize: 14
                                        }}
                                    >
                                        <option value="unrestricted">Unrestricted (42 point threshold)</option>
                                        <option value="small_business">Small Business (36 point threshold)</option>
                                        <option value="wosb">Women-Owned Small Business</option>
                                        <option value="hubzone">HUBZone</option>
                                        <option value="sdvosb">Service-Disabled Veteran-Owned</option>
                                        <option value="8a">8(a)</option>
                                    </select>
                                </div>
                                <button className="btn btn-primary" onClick={handleCreateProposal} disabled={processing}>
                                    {processing ? 'Creating...' : 'Continue'}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Step 2: J.P-1 Upload */}
                    {step === 2 && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Step 2: Upload J.P-1 Qualifications Matrix</h3>
                            </div>
                            <input
                                ref={jp1InputRef}
                                type="file"
                                accept=".xlsx,.xls"
                                onChange={handleJP1Upload}
                                style={{ display: 'none' }}
                            />
                            <div
                                onClick={() => jp1InputRef.current?.click()}
                                style={{
                                    border: '2px dashed var(--border-accent)',
                                    borderRadius: 12,
                                    padding: 48,
                                    textAlign: 'center',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s'
                                }}
                            >
                                <div style={{
                                    width: 64, height: 64,
                                    background: 'rgba(167, 139, 250, 0.15)',
                                    borderRadius: 16,
                                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                                    margin: '0 auto 16px'
                                }}>
                                    <Icon name="FileSpreadsheet" size={32} />
                                </div>
                                {jp1File ? (
                                    <div>
                                        <h4 style={{ color: 'var(--accent-green)', marginBottom: 8 }}>✓ {jp1File.name}</h4>
                                        <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>Click to replace</p>
                                    </div>
                                ) : (
                                    <div>
                                        <h4 style={{ marginBottom: 8 }}>Click to upload J.P-1 Matrix</h4>
                                        <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>Excel file (.xlsx) with scoring criteria</p>
                                    </div>
                                )}
                            </div>
                            {processing && (
                                <div style={{ marginTop: 16, textAlign: 'center', color: 'var(--accent-purple)' }}>
                                    <div className="spinner" style={{ width: 24, height: 24, margin: '0 auto 8px' }}></div>
                                    {status.message}
                                </div>
                            )}
                        </div>
                    )}

                    {/* Step 3: Domain Selection */}
                    {step === 3 && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Step 3: Select Target Domain</h3>
                                <span className="badge badge-green">{domains.length} domains loaded</span>
                            </div>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: 12 }}>
                                {(domains.length > 0 ? domains : DOMAIN_OPTIONS).map(domain => (
                                    <div
                                        key={domain.id || domain.type}
                                        onClick={() => {
                                            setSelectedDomain(domain.id || domain.type);
                                            setStep(4);
                                        }}
                                        style={{
                                            padding: 16,
                                            border: selectedDomain === (domain.id || domain.type) ? '2px solid var(--accent-purple)' : '1px solid var(--border-color)',
                                            borderRadius: 8,
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: 12,
                                            cursor: 'pointer',
                                            background: selectedDomain === (domain.id || domain.type) ? 'rgba(167, 139, 250, 0.1)' : 'transparent',
                                            transition: 'all 0.2s'
                                        }}
                                    >
                                        <Icon name={domain.icon || 'FileText'} size={24} />
                                        <div>
                                            <div style={{ fontWeight: 500 }}>{domain.name}</div>
                                            {domain.criteria_count && (
                                                <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                                    {domain.criteria_count} criteria
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Step 4: Project Documents */}
                    {step === 4 && (
                        <div>
                            <div className="card" style={{ marginBottom: 24 }}>
                                <div className="card-header">
                                    <h3 className="card-title">Step 4: Upload Project Documents</h3>
                                    <span className="badge badge-purple">{projects.length} project(s)</span>
                                </div>
                                <input
                                    ref={projectInputRef}
                                    type="file"
                                    multiple
                                    accept=".pdf,.docx,.doc,.xlsx,.xls"
                                    onChange={handleProjectUpload}
                                    style={{ display: 'none' }}
                                />
                                <div
                                    onClick={() => projectInputRef.current?.click()}
                                    style={{
                                        border: '2px dashed var(--border-accent)',
                                        borderRadius: 12,
                                        padding: 32,
                                        textAlign: 'center',
                                        cursor: 'pointer'
                                    }}
                                >
                                    <Icon name="FolderUp" size={40} />
                                    <h4 style={{ marginTop: 12, marginBottom: 8 }}>Click to upload project documents</h4>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>
                                        Contracts, task orders, CPARS, performance reports
                                    </p>
                                </div>
                                {processing && (
                                    <div style={{ marginTop: 16, textAlign: 'center', color: 'var(--accent-purple)' }}>
                                        <div className="spinner" style={{ width: 24, height: 24, margin: '0 auto 8px' }}></div>
                                        {status.message}
                                    </div>
                                )}
                            </div>

                            {/* Project List */}
                            {projects.length > 0 && (
                                <div className="card" style={{ marginBottom: 24 }}>
                                    <div className="card-header">
                                        <h3 className="card-title">Uploaded Projects</h3>
                                    </div>
                                    {projects.map((proj, idx) => (
                                        <div key={proj.project_id || idx} style={{
                                            padding: 16,
                                            borderBottom: idx < projects.length - 1 ? '1px solid var(--border-color)' : 'none',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: 12
                                        }}>
                                            <div style={{
                                                width: 40, height: 40,
                                                background: 'rgba(79, 140, 255, 0.15)',
                                                borderRadius: 8,
                                                display: 'flex', alignItems: 'center', justifyContent: 'center'
                                            }}>
                                                <Icon name="Briefcase" size={20} />
                                            </div>
                                            <div style={{ flex: 1 }}>
                                                <div style={{ fontWeight: 500 }}>{proj.title}</div>
                                                <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                                    {proj.documents_count || proj.files?.length || 0} document(s)
                                                </div>
                                            </div>
                                            <span className="badge badge-green">Ready</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Action Buttons */}
                            <div style={{ display: 'flex', gap: 12 }}>
                                <button
                                    className="btn btn-primary"
                                    onClick={handleStartScoring}
                                    disabled={processing || projects.length === 0}
                                >
                                    <Icon name="Zap" />
                                    {processing ? status.message : 'Start Scoring Analysis'}
                                </button>
                                <button className="btn btn-secondary" onClick={() => setStep(3)}>
                                    Back
                                </button>
                                <button className="btn btn-secondary" onClick={onCancel}>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Info Box */}
                    <div style={{
                        marginTop: 32,
                        padding: 16,
                        background: 'rgba(79, 140, 255, 0.1)',
                        border: '1px solid rgba(79, 140, 255, 0.2)',
                        borderRadius: 8
                    }}>
                        <div style={{ display: 'flex', gap: 12, alignItems: 'flex-start' }}>
                            <Icon name="Info" size={20} />
                            <div>
                                <strong>How OASIS+ Scoring Works</strong>
                                <p style={{ fontSize: 13, color: 'var(--text-secondary)', marginTop: 4 }}>
                                    PropelAI parses the J.P-1 matrix to extract scoring criteria, then analyzes your project documents
                                    to find evidence supporting each criterion. The optimizer selects the best 5 projects to meet
                                    the {businessSize === 'small_business' ? '36' : '42'}-point threshold.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // OASIS+ Scorecard View Component
        function OASISScorecardView({ proposalId, scorecard, setScorecard, selectedDomain, onBack, onExport, setError }) {
            const [loading, setLoading] = useState(!scorecard);

            useEffect(() => {
                if (!scorecard && proposalId && selectedDomain) {
                    setLoading(true);
                    api.oasisGetScorecard(proposalId, selectedDomain)
                        .then(data => {
                            setScorecard(data);
                            setLoading(false);
                        })
                        .catch(e => {
                            setError('Failed to load scorecard: ' + e.message);
                            setLoading(false);
                        });
                }
            }, [proposalId, selectedDomain]);

            if (loading) {
                return (
                    <div className="animate-in" style={{ textAlign: 'center', padding: 60 }}>
                        <div className="spinner"></div>
                        <p style={{ marginTop: 16, color: 'var(--text-muted)' }}>Loading scorecard...</p>
                    </div>
                );
            }

            if (!scorecard) {
                return (
                    <div className="animate-in">
                        <div className="card" style={{ textAlign: 'center', padding: 60 }}>
                            <Icon name="AlertCircle" size={48} />
                            <h3 style={{ marginTop: 16 }}>No Scorecard Available</h3>
                            <p style={{ color: 'var(--text-muted)', marginTop: 8 }}>Please complete the scoring process first.</p>
                            <button className="btn btn-primary" style={{ marginTop: 24 }} onClick={onBack}>
                                Go Back
                            </button>
                        </div>
                    </div>
                );
            }

            const scorePercent = Math.min(100, (scorecard.total_score / scorecard.threshold) * 100);
            const meetsThreshold = scorecard.total_score >= scorecard.threshold;

            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>OASIS+ Scorecard</h2>
                        <p>Domain: {selectedDomain?.replace(/_/g, ' ').toUpperCase()} · Business Size: {scorecard.business_size}</p>
                    </div>

                    {/* Score Summary */}
                    <div className="stats-grid" style={{ marginBottom: 32 }}>
                        <div className="stat-card" style={{ gridColumn: 'span 2' }}>
                            <div className="label">Total Score</div>
                            <div style={{ display: 'flex', alignItems: 'baseline', gap: 8 }}>
                                <span className="value" style={{ color: meetsThreshold ? 'var(--accent-green)' : 'var(--accent-red)' }}>
                                    {scorecard.total_score}
                                </span>
                                <span style={{ color: 'var(--text-muted)', fontSize: 20 }}>/ {scorecard.threshold} pts</span>
                            </div>
                            <div className="progress-bar" style={{ marginTop: 16, height: 8 }}>
                                <div
                                    className="progress-fill"
                                    style={{
                                        width: `${scorePercent}%`,
                                        background: meetsThreshold ? 'var(--accent-green)' : 'var(--accent-red)'
                                    }}
                                ></div>
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Margin</div>
                            <div className="value" style={{ color: scorecard.margin >= 0 ? 'var(--accent-green)' : 'var(--accent-red)' }}>
                                {scorecard.margin >= 0 ? '+' : ''}{scorecard.margin}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Status</div>
                            <div className="value" style={{ fontSize: 20, color: meetsThreshold ? 'var(--accent-green)' : 'var(--accent-red)' }}>
                                {meetsThreshold ? 'QUALIFIES' : 'BELOW THRESHOLD'}
                            </div>
                        </div>
                    </div>

                    {/* Qualifying Projects */}
                    {scorecard.qualifying_projects && scorecard.qualifying_projects.length > 0 && (
                        <div className="card" style={{ marginBottom: 24 }}>
                            <div className="card-header">
                                <h3 className="card-title">Selected Projects ({scorecard.qualifying_projects.length})</h3>
                            </div>
                            {scorecard.qualifying_projects.map((proj, idx) => (
                                <div key={proj.project_id || idx} style={{
                                    padding: 16,
                                    borderBottom: idx < scorecard.qualifying_projects.length - 1 ? '1px solid var(--border-color)' : 'none',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: 16
                                }}>
                                    <div style={{
                                        width: 36, height: 36,
                                        background: 'var(--bg-tertiary)',
                                        borderRadius: 8,
                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                        fontWeight: 600
                                    }}>
                                        {idx + 1}
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: 500 }}>{proj.title || proj.project_id}</div>
                                        <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                            {proj.client_agency || 'N/A'} · {proj.contract_number || 'N/A'}
                                        </div>
                                    </div>
                                    <span className="badge badge-blue">{proj.score || proj.total_points || 0} pts</span>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Claims/Criteria */}
                    {scorecard.claims && scorecard.claims.length > 0 && (
                        <div className="card" style={{ marginBottom: 24 }}>
                            <div className="card-header">
                                <h3 className="card-title">Scoring Claims ({scorecard.claims.length})</h3>
                            </div>
                            <div style={{ maxHeight: 400, overflow: 'auto' }}>
                                {scorecard.claims.slice(0, 20).map((claim, idx) => (
                                    <div key={idx} style={{
                                        padding: 12,
                                        borderBottom: '1px solid var(--border-color)',
                                        display: 'flex',
                                        alignItems: 'flex-start',
                                        gap: 12
                                    }}>
                                        <span className={`badge badge-${claim.verified ? 'green' : 'amber'}`}>
                                            {claim.points_claimed || 0} pts
                                        </span>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontSize: 13 }}>{claim.criterion_id || claim.criteria_name}</div>
                                            {claim.evidence_snippet && (
                                                <div style={{ fontSize: 12, color: 'var(--text-muted)', marginTop: 4 }}>
                                                    Evidence: {claim.evidence_snippet.slice(0, 100)}...
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Actions */}
                    <div style={{ display: 'flex', gap: 12 }}>
                        <button className="btn btn-primary" onClick={onExport}>
                            <Icon name="Download" />
                            Export Symphony Bundle
                        </button>
                        <button className="btn btn-secondary" onClick={onBack}>
                            <Icon name="ArrowLeft" />
                            Back to Setup
                        </button>
                    </div>
                </div>
            );
        }

        // Main App
        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [apiConnected, setApiConnected] = useState(false);
            const [error, setError] = useState(null);

            // RFP State
            const [currentRfpId, setCurrentRfpId] = useState(null);
            const [rfpType, setRfpType] = useState('standard'); // 'standard' or 'oasis'
            const [files, setFiles] = useState([]);
            const [rawFiles, setRawFiles] = useState([]);
            const [processing, setProcessing] = useState(false);
            const [processingStatus, setProcessingStatus] = useState({ status: '', progress: 0, message: '' });
            const [extractionMode, setExtractionMode] = useState('best_practices');

            // Recent Projects (localStorage)
            const [recentProjects, setRecentProjects] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('propelai_recent_projects') || '[]');
                } catch { return []; }
            });

            // Requirements State
            const [requirements, setRequirements] = useState([]);
            const [stats, setStats] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterType, setFilterType] = useState('all');
            const [filterPriority, setFilterPriority] = useState('all');

            // OASIS+ State
            const [oasisProposalId, setOasisProposalId] = useState(null);
            const [oasisProposal, setOasisProposal] = useState(null);
            const [oasisDomains, setOasisDomains] = useState([]);
            const [oasisSelectedDomain, setOasisSelectedDomain] = useState(null);
            const [oasisJP1File, setOasisJP1File] = useState(null);
            const [oasisProjects, setOasisProjects] = useState([]);
            const [oasisScorecard, setOasisScorecard] = useState(null);
            const [oasisProcessing, setOasisProcessing] = useState(false);
            const [oasisStatus, setOasisStatus] = useState({ step: '', message: '' });

            // Check API health on mount
            useEffect(() => {
                const checkHealth = async () => {
                    try {
                        await api.health();
                        setApiConnected(true);
                    } catch (e) {
                        setApiConnected(false);
                    }
                };
                checkHealth();
                const interval = setInterval(checkHealth, 30000);
                return () => clearInterval(interval);
            }, []);
            
            // Poll for status while processing
            useEffect(() => {
                if (!processing || !currentRfpId) return;
                
                const pollStatus = async () => {
                    try {
                        const status = await api.getStatus(currentRfpId);
                        setProcessingStatus(status);
                        
                        if (status.status === 'completed') {
                            setProcessing(false);
                            await loadRequirements();
                            setCurrentView('matrix');
                        } else if (status.status === 'error') {
                            setProcessing(false);
                            setError(status.message);
                        }
                    } catch (e) {
                        console.error('Status poll error:', e);
                    }
                };
                
                const interval = setInterval(pollStatus, 1000);
                return () => clearInterval(interval);
            }, [processing, currentRfpId]);
            
            // Load requirements
            const loadRequirements = async () => {
                if (!currentRfpId) return;
                
                try {
                    const [rfpData, reqData] = await Promise.all([
                        api.getRFP(currentRfpId),
                        api.getRequirements(currentRfpId)
                    ]);
                    
                    setRequirements(reqData.requirements || []);
                    setStats(rfpData.stats);
                } catch (e) {
                    setError('Failed to load requirements: ' + e.message);
                }
            };
            
            // Process files
            const processFiles = async () => {
                if (rawFiles.length === 0) {
                    setError('Please upload files first');
                    return;
                }
                
                setError(null);
                setProcessing(true);
                setProcessingStatus({ status: 'starting', progress: 0, message: 'Creating RFP project...' });
                
                try {
                    // Create RFP
                    const rfp = await api.createRFP({
                        name: rawFiles[0]?.name?.replace(/\.[^/.]+$/, '') || 'New RFP',
                        solicitation_number: null,
                        agency: null
                    });
                    
                    setCurrentRfpId(rfp.id);
                    setProcessingStatus({ status: 'uploading', progress: 20, message: 'Uploading files...' });
                    
                    // Upload files
                    await api.uploadFiles(rfp.id, rawFiles);
                    setProcessingStatus({ status: 'processing', progress: 40, message: 'Starting processing...' });
                    
                    // Start processing
                    if (extractionMode === 'best_practices') {
                        await api.processRFPBestPractices(rfp.id);
                    } else if (extractionMode === 'semantic') {
                        await api.processRFPSemantic(rfp.id);
                    } else {
                        await api.processRFP(rfp.id);
                    }
                    
                    // Status polling will take over from here
                    
                } catch (e) {
                    setProcessing(false);
                    setError('Processing failed: ' + e.message);
                }
            };
            
            // Export to Excel
            const exportToExcel = () => {
                if (currentRfpId) {
                    api.exportExcel(currentRfpId);
                }
            };
            
            // Filter requirements
            const filteredRequirements = requirements.filter(req => {
                const matchesSearch = searchQuery === '' || 
                    req.text?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    req.id?.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesType = filterType === 'all' || req.type === filterType;
                const matchesPriority = filterPriority === 'all' || req.priority === filterPriority;
                return matchesSearch && matchesType && matchesPriority;
            });
            
            // Save project to recent projects
            const saveToRecentProjects = (project) => {
                const updated = [project, ...recentProjects.filter(p => p.id !== project.id)].slice(0, 10);
                setRecentProjects(updated);
                localStorage.setItem('propelai_recent_projects', JSON.stringify(updated));
            };

            // Handle opening a project from dashboard
            const handleOpenProject = (project) => {
                if (project === 'library') {
                    setCurrentView('library');
                    return;
                }
                if (project.type === 'oasis') {
                    setRfpType('oasis');
                    setCurrentView('oasis_scorecard');
                } else {
                    setRfpType('standard');
                    setCurrentRfpId(project.id);
                    setCurrentView('matrix');
                }
            };

            // Handle new RFP
            const handleNewRFP = () => {
                setRfpType('standard');
                setCurrentView('upload');
            };

            // Handle new OASIS+
            const handleNewOASIS = () => {
                setRfpType('oasis');
                setCurrentView('oasis_upload');
            };

            return (
                <div className="app-container">
                    {/* Sidebar */}
                    <aside className="sidebar">
                        <div className="logo">
                            <h1>PropelAI</h1>
                            <span>RFP Intelligence</span>
                        </div>

                        <nav className="nav-section">
                            <div className="api-status">
                                <span className={`api-dot ${apiConnected ? 'connected' : 'disconnected'}`}></span>
                                <span style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                    {apiConnected ? 'API Connected' : 'API Offline'}
                                </span>
                            </div>

                            <div className="nav-label">Dashboard</div>
                            <div
                                className={`nav-item ${currentView === 'dashboard' ? 'active' : ''}`}
                                onClick={() => setCurrentView('dashboard')}
                            >
                                <Icon name="LayoutDashboard" />
                                <span>Overview</span>
                            </div>

                            <div className="nav-label" style={{ marginTop: 16 }}>RFP Analysis</div>
                            <div
                                className={`nav-item ${currentView === 'upload' ? 'active' : ''}`}
                                onClick={() => { setRfpType('standard'); setCurrentView('upload'); }}
                            >
                                <Icon name="Upload" />
                                <span>Upload RFP</span>
                            </div>
                            <div
                                className={`nav-item ${currentView === 'matrix' ? 'active' : ''} ${!stats ? 'disabled' : ''}`}
                                onClick={() => stats && setCurrentView('matrix')}
                            >
                                <Icon name="Table" />
                                <span>Compliance Matrix</span>
                            </div>
                            <div
                                className={`nav-item ${currentView === 'amendments' ? 'active' : ''} ${!stats ? 'disabled' : ''}`}
                                onClick={() => stats && setCurrentView('amendments')}
                            >
                                <Icon name="GitBranch" />
                                <span>Amendments</span>
                            </div>
                            <div
                                className={`nav-item ${currentView === 'outline' ? 'active' : ''} ${!stats ? 'disabled' : ''}`}
                                onClick={() => stats && setCurrentView('outline')}
                            >
                                <Icon name="FileText" />
                                <span>Proposal Outline</span>
                            </div>

                            <div className="nav-label" style={{ marginTop: 16 }}>OASIS+ Scoring</div>
                            <div
                                className={`nav-item ${currentView === 'oasis_upload' ? 'active' : ''}`}
                                onClick={() => { setRfpType('oasis'); setCurrentView('oasis_upload'); }}
                            >
                                <Icon name="Target" />
                                <span>New Proposal</span>
                            </div>
                            <div
                                className={`nav-item ${currentView === 'oasis_scorecard' ? 'active' : ''} disabled`}
                            >
                                <Icon name="Award" />
                                <span>Scorecard</span>
                            </div>
                            <div
                                className={`nav-item ${currentView === 'oasis_optimizer' ? 'active' : ''} disabled`}
                            >
                                <Icon name="Sparkles" />
                                <span>Optimizer</span>
                            </div>

                            <div className="nav-label" style={{ marginTop: 16 }}>Resources</div>
                            <div
                                className={`nav-item ${currentView === 'library' ? 'active' : ''}`}
                                onClick={() => setCurrentView('library')}
                            >
                                <Icon name="Building" />
                                <span>Company Library</span>
                            </div>
                        </nav>

                        <div className="sidebar-footer">
                            <p>PropelAI v3.0</p>
                            {currentRfpId && <p style={{ marginTop: 4, fontSize: 10, fontFamily: 'JetBrains Mono' }}>{currentRfpId}</p>}
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="main-content">
                        {error && (
                            <div className="error-banner">
                                <strong>Error:</strong> {error}
                                <button
                                    onClick={() => setError(null)}
                                    style={{ float: 'right', background: 'none', border: 'none', color: 'inherit', cursor: 'pointer' }}
                                >
                                    ✕
                                </button>
                            </div>
                        )}

                        {currentView === 'dashboard' && (
                            <DashboardView
                                onNewRFP={handleNewRFP}
                                onNewOASIS={handleNewOASIS}
                                onOpenProject={handleOpenProject}
                                recentProjects={recentProjects}
                                apiConnected={apiConnected}
                            />
                        )}

                        {currentView === 'upload' && (
                            <UploadView 
                                files={files}
                                setFiles={setFiles}
                                rawFiles={rawFiles}
                                setRawFiles={setRawFiles}
                                onProcess={processFiles}
                                apiConnected={apiConnected}
                                extractionMode={extractionMode}
                                setExtractionMode={setExtractionMode}
                            />
                        )}
                        
                        {currentView === 'matrix' && stats && (
                            <MatrixView 
                                requirements={filteredRequirements}
                                allRequirements={requirements}
                                stats={stats}
                                searchQuery={searchQuery}
                                setSearchQuery={setSearchQuery}
                                filterType={filterType}
                                setFilterType={setFilterType}
                                filterPriority={filterPriority}
                                setFilterPriority={setFilterPriority}
                                onExport={exportToExcel}
                            />
                        )}
                        
                        {currentView === 'amendments' && stats && (
                            <AmendmentsView rfpId={currentRfpId} />
                        )}
                        
                        {currentView === 'outline' && stats && (
                            <OutlineView rfpId={currentRfpId} />
                        )}
                        
                        {currentView === 'library' && (
                            <LibraryView />
                        )}

                        {currentView === 'oasis_upload' && (
                            <OASISUploadView
                                proposalId={oasisProposalId}
                                setProposalId={setOasisProposalId}
                                jp1File={oasisJP1File}
                                setJP1File={setOasisJP1File}
                                domains={oasisDomains}
                                setDomains={setOasisDomains}
                                selectedDomain={oasisSelectedDomain}
                                setSelectedDomain={setOasisSelectedDomain}
                                projects={oasisProjects}
                                setProjects={setOasisProjects}
                                processing={oasisProcessing}
                                setProcessing={setOasisProcessing}
                                status={oasisStatus}
                                setStatus={setOasisStatus}
                                setScorecard={setOasisScorecard}
                                onCancel={() => setCurrentView('dashboard')}
                                onComplete={() => setCurrentView('oasis_scorecard')}
                                setError={setError}
                                saveToRecentProjects={saveToRecentProjects}
                            />
                        )}

                        {currentView === 'oasis_scorecard' && (
                            <OASISScorecardView
                                proposalId={oasisProposalId}
                                scorecard={oasisScorecard}
                                setScorecard={setOasisScorecard}
                                selectedDomain={oasisSelectedDomain}
                                onBack={() => setCurrentView('oasis_upload')}
                                onExport={() => api.oasisExportBundle(oasisProposalId, oasisSelectedDomain)}
                                setError={setError}
                            />
                        )}
                    </main>
                    
                    {/* Processing Overlay */}
                    {processing && (
                        <div className="processing-overlay">
                            <div className="processing-card animate-in">
                                <div className="spinner"></div>
                                <h3>Processing RFP</h3>
                                <p>{processingStatus.message}</p>
                                <div className="progress-bar">
                                    <div className="progress-fill" style={{ width: `${processingStatus.progress}%` }}></div>
                                </div>
                                <p style={{ marginTop: 16, fontSize: 12, color: 'var(--text-muted)' }}>
                                    {processingStatus.requirements_count ? `${processingStatus.requirements_count} requirements found` : ''}
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // Upload View
        function UploadView({ files, setFiles, rawFiles, setRawFiles, onProcess, apiConnected, extractionMode, setExtractionMode }) {
            const [dragging, setDragging] = useState(false);
            const fileInputRef = useRef(null);
            
            const handleDrop = (e) => {
                e.preventDefault();
                setDragging(false);
                const droppedFiles = Array.from(e.dataTransfer.files);
                addFiles(droppedFiles);
            };
            
            const handleFileSelect = (e) => {
                const selectedFiles = Array.from(e.target.files);
                addFiles(selectedFiles);
            };
            
            const addFiles = (newFiles) => {
                const validFiles = newFiles.filter(f => {
                    const ext = f.name.split('.').pop().toLowerCase();
                    return ['pdf', 'docx', 'xlsx', 'doc', 'xls'].includes(ext);
                });
                
                const fileData = validFiles.map(f => ({
                    name: f.name,
                    size: formatFileSize(f.size),
                    type: f.name.split('.').pop().toUpperCase(),
                    status: 'ready'
                }));
                
                setFiles([...files, ...fileData]);
                setRawFiles([...rawFiles, ...validFiles]);
            };
            
            const removeFile = (index) => {
                setFiles(files.filter((_, i) => i !== index));
                setRawFiles(rawFiles.filter((_, i) => i !== index));
            };
            
            const clearAll = () => {
                setFiles([]);
                setRawFiles([]);
            };
            
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Upload RFP Documents</h2>
                        <p>Upload your RFP package to extract requirements and build a compliance matrix</p>
                    </div>
                    
                    <div 
                        className={`upload-zone ${dragging ? 'dragging' : ''}`}
                        onDragOver={(e) => { e.preventDefault(); setDragging(true); }}
                        onDragLeave={() => setDragging(false)}
                        onDrop={handleDrop}
                        onClick={() => fileInputRef.current?.click()}
                    >
                        <input
                            ref={fileInputRef}
                            type="file"
                            multiple
                            accept=".pdf,.docx,.xlsx,.doc,.xls"
                            onChange={handleFileSelect}
                            style={{ display: 'none' }}
                        />
                        <div className="upload-icon">
                            <Icon name="Upload" size={28} />
                        </div>
                        <h3>Drop files here or click to browse</h3>
                        <p>Upload RFP documents, amendments, attachments, and Q&A files</p>
                        <div className="file-types">
                            <span className="file-type">.pdf</span>
                            <span className="file-type">.docx</span>
                            <span className="file-type">.xlsx</span>
                        </div>
                    </div>
                    
                    {files.length > 0 && (
                        <div className="file-list">
                            {files.map((file, index) => (
                                <div key={index} className="file-item">
                                    <div className="file-icon">
                                        <Icon name="FileText" />
                                    </div>
                                    <div className="file-info">
                                        <div className="file-name">{file.name}</div>
                                        <div className="file-meta">{file.type} · {file.size}</div>
                                    </div>
                                    <div className="file-status">
                                        <span className="badge badge-green">Ready</span>
                                        <button 
                                            className="btn btn-ghost"
                                            onClick={(e) => { e.stopPropagation(); removeFile(index); }}
                                        >
                                            <Icon name="X" size={16} />
                                        </button>
                                    </div>
                                </div>
                            ))}
                            
                            <div style={{ marginTop: 24, display: 'flex', gap: 12, alignItems: 'center', flexWrap: 'wrap' }}>
                                <button 
                                    className="btn btn-primary" 
                                    onClick={onProcess}
                                    disabled={!apiConnected}
                                >
                                    <Icon name="Zap" />
                                    {apiConnected ? 'Process RFP' : 'API Offline'}
                                </button>
                                <button className="btn btn-secondary" onClick={clearAll}>
                                    Clear All
                                </button>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginLeft: 16 }}>
                                    <span style={{ color: 'var(--text-secondary)', fontSize: 13 }}>
                                        Extraction Mode:
                                    </span>
                                    <select 
                                        value={extractionMode}
                                        onChange={(e) => setExtractionMode(e.target.value)}
                                        style={{ 
                                            background: 'var(--bg-secondary)', 
                                            border: '1px solid var(--border-color)',
                                            borderRadius: 6,
                                            padding: '6px 12px',
                                            color: 'var(--text-primary)',
                                            fontSize: 13,
                                            cursor: 'pointer'
                                        }}
                                    >
                                        <option value="best_practices">v2.9 Best Practices CTM</option>
                                        <option value="semantic">v2.8 Semantic</option>
                                        <option value="legacy">Legacy</option>
                                    </select>
                                    {extractionMode === 'best_practices' && (
                                        <span 
                                            style={{ 
                                                fontSize: 10, 
                                                background: 'var(--accent-green)', 
                                                color: 'black', 
                                                padding: '2px 6px', 
                                                borderRadius: 4,
                                                fontWeight: 600
                                            }}
                                        >
                                            NEW
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // Matrix View
        function MatrixView({ 
            requirements, allRequirements, stats, 
            searchQuery, setSearchQuery, 
            filterType, setFilterType,
            filterPriority, setFilterPriority,
            onExport
        }) {
            const uniqueTypes = [...new Set(allRequirements.map(r => r.type).filter(Boolean))];
            
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Compliance Matrix</h2>
                        <p>Extracted {stats?.total || allRequirements.length} requirements from your RFP documents</p>
                    </div>
                    
                    {/* RFP Format Note (for GSA/BPA) */}
                    {stats?.is_non_ucf_format && (
                        <div style={{
                            background: 'rgba(251, 146, 60, 0.1)',
                            border: '1px solid rgba(251, 146, 60, 0.3)',
                            borderRadius: '8px',
                            padding: '12px 16px',
                            marginBottom: '20px',
                            display: 'flex',
                            alignItems: 'flex-start',
                            gap: '12px'
                        }}>
                            <span style={{ color: '#fb923c', fontSize: '18px' }}>ℹ️</span>
                            <div>
                                <div style={{ fontWeight: '600', color: '#fb923c', marginBottom: '4px' }}>
                                    GSA Schedule / BPA Format Detected
                                </div>
                                <div style={{ fontSize: '13px', color: 'rgba(255,255,255,0.7)' }}>
                                    This RFP does not follow the standard UCF format (Sections L/M/C). 
                                    Submission instructions are in <strong>Section M Alignment</strong> ({stats?.evaluation || 0} items). 
                                    Technical requirements are in the <strong>PWS/SOW</strong> ({stats?.technical || 0} items).
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Stats */}
                    <div className="stats-grid">
                        <div className="stat-card blue">
                            <div className="label">Total Requirements</div>
                            <div className="value">{stats?.total || allRequirements.length}</div>
                        </div>
                        <div className="stat-card red">
                            <div className="label">High Priority</div>
                            <div className="value">{stats?.by_priority?.high || 0}</div>
                        </div>
                        <div className="stat-card amber">
                            <div className="label">Medium Priority</div>
                            <div className="value">{stats?.by_priority?.medium || 0}</div>
                        </div>
                        <div className="stat-card green">
                            <div className="label">Low Priority</div>
                            <div className="value">{stats?.by_priority?.low || 0}</div>
                        </div>
                    </div>
                    
                    {/* Actions */}
                    <div className="actions-bar">
                        <div className="search-box">
                            <Icon name="Search" />
                            <input 
                                type="text"
                                placeholder="Search requirements..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>
                        <div className="filter-group">
                            <select value={filterType} onChange={(e) => setFilterType(e.target.value)}>
                                <option value="all">All Types</option>
                                {uniqueTypes.map(type => (
                                    <option key={type} value={type}>{type}</option>
                                ))}
                            </select>
                            <select value={filterPriority} onChange={(e) => setFilterPriority(e.target.value)}>
                                <option value="all">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                            <button className="btn btn-primary" onClick={onExport}>
                                <Icon name="Download" />
                                Export Excel
                            </button>
                        </div>
                    </div>
                    
                    {/* Table */}
                    <div className="card">
                        <div className="table-container" style={{ maxHeight: '500px', overflow: 'auto' }}>
                            <table>
                                <thead>
                                    <tr>
                                        <th style={{ width: 100 }}>ID</th>
                                        <th>Requirement</th>
                                        <th style={{ width: 100 }}>Section</th>
                                        <th style={{ width: 120 }}>Type</th>
                                        <th style={{ width: 100 }}>Priority</th>
                                        <th style={{ width: 80 }}>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {requirements.map((req, idx) => (
                                        <tr key={req.id || idx}>
                                            <td><span className="req-id">{req.id}</span></td>
                                            <td className="req-text" title={req.text}>{req.text}</td>
                                            <td>{req.section}</td>
                                            <td><span className={`badge badge-${getTypeBadgeColor(req.type)}`}>{req.type}</span></td>
                                            <td>
                                                <span className={`priority-dot priority-${req.priority}`}></span>
                                                {req.priority}
                                            </td>
                                            <td>{Math.round((req.confidence || 0) * 100)}%</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style={{ marginTop: 16, color: 'var(--text-muted)', fontSize: 14 }}>
                        Showing {requirements.length} of {allRequirements.length} requirements
                        {stats?.processing_time && ` · Processed in ${stats.processing_time.toFixed(2)}s`}
                    </div>
                </div>
            );
        }
        
        // Amendments View
        function AmendmentsView({ rfpId }) {
            const [amendments, setAmendments] = useState([]);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                if (rfpId) {
                    api.getAmendments(rfpId).then(data => {
                        setAmendments(data.amendments || []);
                        setLoading(false);
                    }).catch(() => setLoading(false));
                }
            }, [rfpId]);
            
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Amendment Tracking</h2>
                        <p>Track changes across RFP versions and amendments</p>
                    </div>
                    
                    {loading ? (
                        <div style={{ textAlign: 'center', padding: 60, color: 'var(--text-muted)' }}>
                            Loading amendments...
                        </div>
                    ) : amendments.length === 0 ? (
                        <div className="card" style={{ textAlign: 'center', padding: 60 }}>
                            <Icon name="GitBranch" size={48} />
                            <h3 style={{ marginTop: 16, marginBottom: 8 }}>No Amendments Yet</h3>
                            <p style={{ color: 'var(--text-muted)' }}>
                                Upload amendment documents to track changes
                            </p>
                        </div>
                    ) : (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Amendment History</h3>
                            </div>
                            {amendments.map((a, idx) => (
                                <div key={idx} style={{ 
                                    padding: 16, 
                                    borderBottom: '1px solid var(--border-color)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: 16
                                }}>
                                    <div style={{ 
                                        width: 40, height: 40, 
                                        background: 'var(--bg-tertiary)', 
                                        borderRadius: 8,
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 600
                                    }}>
                                        {a.number}
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: 500 }}>Amendment {a.number}</div>
                                        <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>{a.date} · {a.file}</div>
                                    </div>
                                    <div style={{ display: 'flex', gap: 8 }}>
                                        <span className="badge badge-green">+{a.changes?.added || 0}</span>
                                        <span className="badge badge-amber">{a.changes?.modified || 0}</span>
                                        <span className="badge badge-red">-{a.changes?.deleted || 0}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        // Outline View
        function OutlineView({ rfpId }) {
            const [outline, setOutline] = useState(null);
            const [loading, setLoading] = useState(true);
            const [generating, setGenerating] = useState(false);
            const [activeVolume, setActiveVolume] = useState(null);
            
            useEffect(() => {
                if (rfpId) {
                    loadOutline();
                }
            }, [rfpId]);
            
            const loadOutline = async () => {
                setLoading(true);
                try {
                    const data = await api.getOutline(rfpId);
                    setOutline(data.outline);
                    if (data.outline?.volumes?.length > 0) {
                        setActiveVolume(data.outline.volumes[0].id);
                    }
                } catch (e) {
                    // Outline not generated yet
                    setOutline(null);
                } finally {
                    setLoading(false);
                }
            };
            
            const generateOutline = async () => {
                setGenerating(true);
                try {
                    const data = await api.generateOutline(rfpId);
                    setOutline(data.outline);
                    if (data.outline?.volumes?.length > 0) {
                        setActiveVolume(data.outline.volumes[0].id);
                    }
                } catch (e) {
                    console.error('Failed to generate outline:', e);
                } finally {
                    setGenerating(false);
                }
            };
            
            const getVolumeIcon = (type) => {
                const icons = {
                    technical: 'Cpu',
                    management: 'Users',
                    past_performance: 'Award',
                    cost_price: 'DollarSign',
                    staffing: 'UserCheck',
                    small_business: 'Building',
                    oral_presentation: 'Presentation',
                    other: 'FileText'
                };
                return icons[type] || 'FileText';
            };
            
            if (loading) {
                return (
                    <div className="animate-in" style={{ textAlign: 'center', padding: 60 }}>
                        <div className="spinner"></div>
                        <p style={{ marginTop: 16, color: 'var(--text-muted)' }}>Loading outline...</p>
                    </div>
                );
            }
            
            if (!outline) {
                return (
                    <div className="animate-in">
                        <div className="page-header">
                            <h2>Proposal Outline</h2>
                            <p>Generate a proposal outline from Section L/M</p>
                        </div>
                        
                        <div className="card" style={{ textAlign: 'center', padding: 60 }}>
                            <Icon name="FileText" size={48} />
                            <h3 style={{ marginTop: 16, marginBottom: 8 }}>Generate Proposal Outline</h3>
                            <p style={{ color: 'var(--text-muted)', marginBottom: 24 }}>
                                Parse Section L (Instructions) and Section M (Evaluation Factors) to create a proposal-ready outline
                            </p>
                            <button 
                                className="btn btn-primary" 
                                onClick={generateOutline}
                                disabled={generating}
                            >
                                {generating ? (
                                    <>
                                        <span className="spinner" style={{ width: 18, height: 18, borderWidth: 2 }}></span>
                                        Generating...
                                    </>
                                ) : (
                                    <>
                                        <Icon name="Zap" />
                                        Generate Outline
                                    </>
                                )}
                            </button>
                        </div>
                    </div>
                );
            }
            
            const activeVolumeData = outline.volumes?.find(v => v.id === activeVolume);
            
            return (
                <div className="animate-in">
                    <div className="page-header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                        <div>
                            <h2>Proposal Outline</h2>
                            <p>Structure your proposal based on RFP requirements</p>
                        </div>
                        <button 
                            className="btn btn-primary"
                            onClick={() => api.exportOutline(rfpId)}
                            title="Download annotated outline as Word document"
                        >
                            <Icon name="Download" />
                            Export Outline
                        </button>
                    </div>
                    
                    {/* Submission & Format Info */}
                    <div className="stats-grid" style={{ marginBottom: 24 }}>
                        <div className="stat-card">
                            <div className="label">Due Date</div>
                            <div className="value" style={{ fontSize: 18 }}>
                                {outline.submission?.due_date || 'TBD'}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Submission</div>
                            <div className="value" style={{ fontSize: 18, textTransform: 'capitalize' }}>
                                {outline.submission?.method || 'Not specified'}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Total Pages</div>
                            <div className="value" style={{ fontSize: 18 }}>
                                {outline.total_page_limit || 'No limit'}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Volumes</div>
                            <div className="value" style={{ fontSize: 18 }}>
                                {outline.volumes?.length || 0}
                            </div>
                        </div>
                    </div>
                    
                    <div style={{ display: 'grid', gridTemplateColumns: '300px 1fr', gap: 24 }}>
                        {/* Volumes Sidebar */}
                        <div className="card" style={{ padding: 0 }}>
                            <div style={{ padding: 16, borderBottom: '1px solid var(--border-color)' }}>
                                <h3 style={{ fontSize: 14, fontWeight: 600 }}>Proposal Volumes</h3>
                            </div>
                            {outline.volumes?.map((vol) => (
                                <div 
                                    key={vol.id}
                                    onClick={() => setActiveVolume(vol.id)}
                                    style={{ 
                                        padding: 16, 
                                        borderBottom: '1px solid var(--border-color)',
                                        cursor: 'pointer',
                                        background: activeVolume === vol.id ? 'rgba(79, 140, 255, 0.1)' : 'transparent',
                                        borderLeft: activeVolume === vol.id ? '3px solid var(--accent-blue)' : '3px solid transparent'
                                    }}
                                >
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                        <Icon name={getVolumeIcon(vol.type)} size={18} />
                                        <div>
                                            <div style={{ fontWeight: 500, fontSize: 14 }}>{vol.name}</div>
                                            <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                                {vol.page_limit ? `${vol.page_limit} pages` : 'No page limit'}
                                                {vol.sections?.length > 0 && ` · ${vol.sections.length} sections`}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        {/* Volume Detail */}
                        <div>
                            {/* Evaluation Factors */}
                            <div className="card" style={{ marginBottom: 24 }}>
                                <div className="card-header">
                                    <h3 className="card-title">Evaluation Factors</h3>
                                </div>
                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: 12 }}>
                                    {outline.evaluation_factors?.map((factor, idx) => (
                                        <div key={idx} style={{ 
                                            padding: '12px 16px', 
                                            background: 'var(--bg-tertiary)', 
                                            borderRadius: 8,
                                            flex: '1 1 200px'
                                        }}>
                                            <div style={{ fontWeight: 500, marginBottom: 4 }}>{factor.name}</div>
                                            {factor.weight && (
                                                <span className="badge badge-blue">
                                                    {factor.weight} {factor.weight_type || 'pts'}
                                                </span>
                                            )}
                                            {factor.importance && (
                                                <span className="badge badge-purple" style={{ marginLeft: 8 }}>
                                                    {factor.importance}
                                                </span>
                                            )}
                                            {factor.subfactors?.length > 0 && (
                                                <div style={{ marginTop: 8, fontSize: 12, color: 'var(--text-secondary)' }}>
                                                    {factor.subfactors.map((sf, i) => (
                                                        <div key={i}>• {sf.name}</div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            {/* Active Volume Sections */}
                            {activeVolumeData && (
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">{activeVolumeData.name} - Sections</h3>
                                        {activeVolumeData.page_limit && (
                                            <span className="badge badge-blue">{activeVolumeData.page_limit} pages</span>
                                        )}
                                    </div>
                                    
                                    {activeVolumeData.sections?.length > 0 ? (
                                        activeVolumeData.sections.map((section, idx) => (
                                            <div key={idx} style={{ 
                                                padding: 16, 
                                                borderBottom: '1px solid var(--border-color)'
                                            }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                                                    <div>
                                                        <div style={{ fontWeight: 500, marginBottom: 8 }}>{section.title}</div>
                                                        
                                                        {section.content_requirements?.length > 0 && (
                                                            <div style={{ marginBottom: 8 }}>
                                                                <div style={{ fontSize: 11, color: 'var(--text-muted)', marginBottom: 4 }}>CONTENT REQUIREMENTS</div>
                                                                {section.content_requirements.slice(0, 2).map((req, i) => (
                                                                    <div key={i} style={{ fontSize: 13, color: 'var(--text-secondary)', marginBottom: 2 }}>
                                                                        • {req.slice(0, 150)}{req.length > 150 ? '...' : ''}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                        
                                                        {section.compliance_checkpoints?.length > 0 && (
                                                            <div>
                                                                <div style={{ fontSize: 11, color: 'var(--text-muted)', marginBottom: 4 }}>CHECKLIST</div>
                                                                {section.compliance_checkpoints.slice(0, 3).map((cp, i) => (
                                                                    <div key={i} style={{ fontSize: 13, color: 'var(--text-secondary)' }}>
                                                                        {cp}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                    {section.page_limit && (
                                                        <span className="badge badge-gray">{section.page_limit}p</span>
                                                    )}
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div style={{ padding: 24, textAlign: 'center', color: 'var(--text-muted)' }}>
                                            No detailed sections found for this volume
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {/* Warnings */}
                            {outline.warnings?.length > 0 && (
                                <div className="card" style={{ marginTop: 24, background: 'rgba(251, 191, 36, 0.1)', borderColor: 'var(--accent-amber)' }}>
                                    <div className="card-header">
                                        <h3 className="card-title" style={{ color: 'var(--accent-amber)' }}>⚠️ Warnings</h3>
                                    </div>
                                    {outline.warnings.map((warning, idx) => (
                                        <div key={idx} style={{ padding: '8px 16px', fontSize: 14 }}>
                                            {warning}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Company Library View
        function LibraryView() {
            const [library, setLibrary] = useState(null);
            const [loading, setLoading] = useState(true);
            const [uploading, setUploading] = useState(false);
            const [activeTab, setActiveTab] = useState('overview');
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const fileInputRef = useRef(null);
            
            useEffect(() => {
                loadLibrary();
            }, []);
            
            const loadLibrary = async () => {
                try {
                    const response = await fetch('/api/library');
                    const data = await response.json();
                    setLibrary(data);
                } catch (error) {
                    console.error('Error loading library:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                setUploading(true);
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch('/api/library/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success) {
                        loadLibrary();
                    }
                } catch (error) {
                    console.error('Error uploading:', error);
                } finally {
                    setUploading(false);
                    fileInputRef.current.value = '';
                }
            };
            
            const handleSearch = async () => {
                if (!searchQuery.trim()) return;
                
                try {
                    const response = await fetch(`/api/library/search?query=${encodeURIComponent(searchQuery)}`);
                    const data = await response.json();
                    setSearchResults(data.results || []);
                } catch (error) {
                    console.error('Error searching:', error);
                }
            };
            
            const deleteDocument = async (docId) => {
                if (!confirm('Remove this document from library?')) return;
                
                try {
                    await fetch(`/api/library/documents/${docId}`, { method: 'DELETE' });
                    loadLibrary();
                } catch (error) {
                    console.error('Error deleting:', error);
                }
            };
            
            if (loading) {
                return (
                    <div style={{ padding: 40, textAlign: 'center' }}>
                        <div className="spinner"></div>
                        <p style={{ marginTop: 16 }}>Loading library...</p>
                    </div>
                );
            }
            
            return (
                <div>
                    <div className="view-header">
                        <div>
                            <h1>Company Library</h1>
                            <p className="text-muted">Upload capabilities statements, past performance, and resumes for enhanced proposal generation</p>
                        </div>
                        <div>
                            <input
                                type="file"
                                ref={fileInputRef}
                                onChange={handleFileUpload}
                                accept=".docx,.doc,.pdf,.txt,.md"
                                style={{ display: 'none' }}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => fileInputRef.current.click()}
                                disabled={uploading}
                            >
                                {uploading ? 'Uploading...' : '+ Upload Document'}
                            </button>
                        </div>
                    </div>
                    
                    {/* Stats Cards */}
                    <div className="stats-grid" style={{ marginBottom: 24 }}>
                        <div className="stat-card">
                            <div className="stat-label">Documents</div>
                            <div className="stat-value">{library?.document_count || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Capabilities</div>
                            <div className="stat-value">{library?.profile_summary?.capabilities_count || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Differentiators</div>
                            <div className="stat-value">{library?.profile_summary?.differentiators_count || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Past Performance</div>
                            <div className="stat-value">{library?.profile_summary?.past_performance_count || 0}</div>
                        </div>
                    </div>
                    
                    {/* Tabs */}
                    <div style={{ display: 'flex', gap: 8, marginBottom: 16, borderBottom: '1px solid var(--border-color)', paddingBottom: 8 }}>
                        {['overview', 'documents', 'search'].map(tab => (
                            <button
                                key={tab}
                                className={`btn ${activeTab === tab ? 'btn-primary' : ''}`}
                                onClick={() => setActiveTab(tab)}
                                style={{ textTransform: 'capitalize' }}
                            >
                                {tab}
                            </button>
                        ))}
                    </div>
                    
                    {activeTab === 'overview' && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">
                                    {library?.profile_summary?.company_name || 'Company Profile'}
                                </h3>
                            </div>
                            
                            {library?.document_count === 0 ? (
                                <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-muted)' }}>
                                    <Icon name="Building" style={{ width: 48, height: 48, marginBottom: 16, opacity: 0.5 }} />
                                    <p>No documents in library yet</p>
                                    <p style={{ fontSize: 13, marginTop: 8 }}>Upload a capabilities statement to get started</p>
                                </div>
                            ) : (
                                <div style={{ padding: 16 }}>
                                    <p style={{ marginBottom: 16 }}>
                                        Your library contains <strong>{library?.profile_summary?.capabilities_count || 0}</strong> capabilities, 
                                        <strong> {library?.profile_summary?.differentiators_count || 0}</strong> differentiators, and 
                                        <strong> {library?.profile_summary?.past_performance_count || 0}</strong> past performance records.
                                    </p>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>
                                        This content will be used to enhance your proposal drafts with relevant company information.
                                    </p>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {activeTab === 'documents' && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Uploaded Documents</h3>
                            </div>
                            
                            {library?.documents?.length === 0 ? (
                                <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-muted)' }}>
                                    No documents uploaded yet
                                </div>
                            ) : (
                                library?.documents?.map(doc => (
                                    <div key={doc.id} style={{ 
                                        padding: 16, 
                                        borderBottom: '1px solid var(--border-color)',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center'
                                    }}>
                                        <div>
                                            <div style={{ fontWeight: 500 }}>{doc.title}</div>
                                            <div style={{ fontSize: 13, color: 'var(--text-muted)', marginTop: 4 }}>
                                                <span className={`badge badge-${doc.type === 'capabilities' ? 'blue' : doc.type === 'resume' ? 'green' : 'purple'}`}>
                                                    {doc.type}
                                                </span>
                                                <span style={{ marginLeft: 8 }}>{doc.filename}</span>
                                            </div>
                                        </div>
                                        <button 
                                            className="btn"
                                            onClick={() => deleteDocument(doc.id)}
                                            style={{ color: 'var(--accent-red)' }}
                                        >
                                            Remove
                                        </button>
                                    </div>
                                ))
                            )}
                        </div>
                    )}
                    
                    {activeTab === 'search' && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Search Library</h3>
                            </div>
                            <div style={{ padding: 16 }}>
                                <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Search capabilities, differentiators, past performance..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                        style={{ flex: 1 }}
                                    />
                                    <button className="btn btn-primary" onClick={handleSearch}>
                                        Search
                                    </button>
                                </div>
                                
                                {searchResults.length > 0 && (
                                    <div>
                                        <div style={{ fontSize: 13, color: 'var(--text-muted)', marginBottom: 12 }}>
                                            Found {searchResults.length} results
                                        </div>
                                        {searchResults.map((result, idx) => (
                                            <div key={idx} style={{ 
                                                padding: 12, 
                                                background: 'var(--bg-tertiary)', 
                                                borderRadius: 8,
                                                marginBottom: 8
                                            }}>
                                                <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 4 }}>
                                                    <span className={`badge badge-${result.type === 'capability' ? 'blue' : result.type === 'differentiator' ? 'purple' : 'green'}`}>
                                                        {result.type}
                                                    </span>
                                                    <span style={{ fontWeight: 500 }}>
                                                        {result.content.name || result.content.title || result.content.project_name}
                                                    </span>
                                                </div>
                                                <div style={{ fontSize: 13, color: 'var(--text-secondary)' }}>
                                                    {result.content.description?.slice(0, 200) || ''}
                                                    {result.content.description?.length > 200 ? '...' : ''}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // Helpers
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        function getTypeBadgeColor(type) {
            const colors = {
                performance: 'blue',
                compliance: 'purple',
                technical: 'green',
                deliverable: 'amber',
                prohibition: 'red',
                evaluation: 'purple',
                proposal_instruction: 'gray',
                labor_requirement: 'amber'
            };
            return colors[type] || 'gray';
        }
        
        // Render
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
