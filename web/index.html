<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PropelAI - RFP Intelligence Platform</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a24;
            --bg-card: #16161f;
            --border-color: #2a2a3a;
            --border-accent: #3a3a4a;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --accent-blue: #4f8cff;
            --accent-blue-dim: #3a6acc;
            --accent-green: #34d399;
            --accent-amber: #fbbf24;
            --accent-red: #f87171;
            --accent-purple: #a78bfa;
            --gradient-blue: linear-gradient(135deg, #4f8cff 0%, #7c3aed 100%);
            --gradient-card: linear-gradient(180deg, rgba(79, 140, 255, 0.05) 0%, transparent 100%);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-accent); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
        
        .app-container { display: flex; min-height: 100vh; }
        
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        
        .logo { padding: 24px; border-bottom: 1px solid var(--border-color); }
        
        .logo h1 {
            font-size: 22px;
            font-weight: 700;
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .logo span {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: block;
            margin-top: 4px;
        }
        
        .nav-section { padding: 16px 12px; flex: 1; }
        
        .nav-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            padding: 8px 12px;
            margin-bottom: 4px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            margin-bottom: 2px;
        }
        
        .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .nav-item.active { background: rgba(79, 140, 255, 0.15); color: var(--accent-blue); }
        .nav-item.disabled { opacity: 0.5; cursor: not-allowed; }
        .nav-item svg { width: 18px; height: 18px; opacity: 0.8; }
        
        .main-content { flex: 1; margin-left: 260px; padding: 32px 40px; background: var(--bg-primary); }
        
        .page-header { margin-bottom: 32px; }
        .page-header h2 { font-size: 28px; font-weight: 600; letter-spacing: -0.5px; margin-bottom: 8px; }
        .page-header p { color: var(--text-secondary); font-size: 15px; }
        
        .upload-zone {
            border: 2px dashed var(--border-accent);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            background: var(--gradient-card);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .upload-zone:hover { border-color: var(--accent-blue); background: rgba(79, 140, 255, 0.05); }
        .upload-zone.dragging { border-color: var(--accent-blue); background: rgba(79, 140, 255, 0.1); transform: scale(1.01); }
        
        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-icon svg { width: 28px; height: 28px; color: var(--accent-blue); }
        .upload-zone h3 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .upload-zone p { color: var(--text-secondary); font-size: 14px; margin-bottom: 16px; }
        
        .file-types { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        
        .file-type {
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
        }

        /* Guided Upload Styles */
        .upload-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 8px;
            width: fit-content;
        }
        .upload-mode-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            color: var(--text-secondary);
        }
        .upload-mode-btn.active {
            background: var(--accent-blue);
            color: white;
        }
        .upload-mode-btn:hover:not(.active) {
            background: var(--border-color);
        }

        .guided-upload-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }
        @media (max-width: 900px) {
            .guided-upload-grid { grid-template-columns: 1fr; }
        }

        .upload-slot {
            background: var(--bg-card);
            border: 2px dashed var(--border-accent);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        .upload-slot:hover { border-color: var(--accent-blue); }
        .upload-slot.has-file { border-style: solid; border-color: var(--accent-green); background: rgba(52, 211, 153, 0.05); }
        .upload-slot.required { position: relative; }
        .upload-slot.required::after {
            content: 'REQUIRED';
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 9px;
            font-weight: 700;
            color: var(--accent-amber);
            letter-spacing: 1px;
        }
        .upload-slot.not-applicable { opacity: 0.5; border-style: dotted; }

        .slot-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }
        .slot-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        .slot-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .slot-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        .slot-help {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
        }
        .slot-help strong { color: var(--text-secondary); }

        .slot-file {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-secondary);
            padding: 10px 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        .slot-file-name {
            flex: 1;
            font-size: 13px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .slot-file-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }
        .slot-file-remove:hover { background: var(--bg-tertiary); color: var(--accent-red); }

        .slot-na-btn {
            font-size: 11px;
            color: var(--text-muted);
            background: none;
            border: none;
            cursor: pointer;
            margin-top: 8px;
            text-decoration: underline;
        }
        .slot-na-btn:hover { color: var(--text-secondary); }

        .skip-docs-section {
            background: rgba(248, 113, 113, 0.05);
            border: 1px solid rgba(248, 113, 113, 0.2);
            border-radius: 12px;
            padding: 16px 20px;
            margin-top: 24px;
        }
        .skip-docs-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-red);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .skip-docs-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .skip-doc-tag {
            font-size: 11px;
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 4px;
            color: var(--text-secondary);
        }

        .upload-tips {
            background: rgba(79, 140, 255, 0.05);
            border: 1px solid rgba(79, 140, 255, 0.2);
            border-radius: 12px;
            padding: 16px 20px;
            margin-top: 16px;
        }
        .upload-tips-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 8px;
        }
        .upload-tips ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .upload-tips li {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }
        .upload-tips li::before {
            content: 'ðŸ’¡';
            position: absolute;
            left: 0;
            font-size: 11px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
        }
        
        .btn-primary { background: var(--gradient-blue); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(79, 140, 255, 0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--border-color); }
        .btn-ghost { background: transparent; color: var(--text-secondary); padding: 8px; }
        .btn-ghost:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .btn svg { width: 18px; height: 18px; }
        
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .card-title { font-size: 16px; font-weight: 600; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .stat-card .label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .stat-card .value { font-size: 32px; font-weight: 700; letter-spacing: -1px; }
        .stat-card.blue .value { color: var(--accent-blue); }
        .stat-card.green .value { color: var(--accent-green); }
        .stat-card.amber .value { color: var(--accent-amber); }
        .stat-card.red .value { color: var(--accent-red); }
        
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 14px 16px; border-bottom: 1px solid var(--border-color); }
        th { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); font-weight: 600; background: var(--bg-tertiary); position: sticky; top: 0; }
        th:first-child { border-radius: 8px 0 0 0; }
        th:last-child { border-radius: 0 8px 0 0; }
        tr:hover td { background: rgba(79, 140, 255, 0.03); }
        td { font-size: 14px; }
        
        .req-id { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--accent-blue); }
        .req-text { max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        .badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-blue { background: rgba(79, 140, 255, 0.15); color: var(--accent-blue); }
        .badge-green { background: rgba(52, 211, 153, 0.15); color: var(--accent-green); }
        .badge-amber { background: rgba(251, 191, 36, 0.15); color: var(--accent-amber); }
        .badge-red { background: rgba(248, 113, 113, 0.15); color: var(--accent-red); }
        .badge-purple { background: rgba(167, 139, 250, 0.15); color: var(--accent-purple); }
        .badge-gray { background: var(--bg-tertiary); color: var(--text-secondary); }
        
        .priority-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .priority-high { background: var(--accent-red); }
        .priority-medium { background: var(--accent-amber); }
        .priority-low { background: var(--accent-green); }
        
        .progress-bar { height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gradient-blue); border-radius: 3px; transition: width 0.5s ease; }
        
        .file-list { display: flex; flex-direction: column; gap: 8px; margin-top: 24px; }
        .file-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color); }
        .file-icon { width: 40px; height: 40px; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .file-icon svg { width: 20px; height: 20px; color: var(--accent-blue); }
        .file-info { flex: 1; }
        .file-name { font-weight: 500; font-size: 14px; }
        .file-meta { font-size: 12px; color: var(--text-muted); }
        .file-status { display: flex; align-items: center; gap: 8px; }
        
        .tabs { display: flex; gap: 4px; background: var(--bg-tertiary); padding: 4px; border-radius: 10px; margin-bottom: 24px; }
        .tab { padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; border: none; background: transparent; font-family: inherit; }
        .tab:hover { color: var(--text-primary); }
        .tab.active { background: var(--bg-card); color: var(--text-primary); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        
        .processing-overlay { position: fixed; inset: 0; background: rgba(10, 10, 15, 0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(8px); }
        .processing-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 48px 64px; text-align: center; max-width: 480px; }
        .spinner { width: 48px; height: 48px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 24px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .processing-card h3 { font-size: 20px; margin-bottom: 8px; }
        .processing-card p { color: var(--text-secondary); margin-bottom: 24px; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(10, 10, 15, 0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(8px); }
        .modal { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; max-width: 480px; width: 100%; margin: 16px; animation: modalIn 0.2s ease; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .actions-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .search-box { display: flex; align-items: center; gap: 8px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 16px; width: 300px; }
        .search-box input { flex: 1; background: transparent; border: none; color: var(--text-primary); font-size: 14px; outline: none; font-family: inherit; }
        .search-box input::placeholder { color: var(--text-muted); }
        .search-box svg { width: 18px; height: 18px; color: var(--text-muted); }
        .filter-group { display: flex; gap: 8px; }
        
        select { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 16px; color: var(--text-primary); font-size: 14px; font-family: inherit; cursor: pointer; outline: none; }
        select:focus { border-color: var(--accent-blue); }
        
        .sidebar-footer { padding: 16px 24px; border-top: 1px solid var(--border-color); }
        .sidebar-footer p { font-size: 12px; color: var(--text-muted); }
        
        .api-status { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--bg-tertiary); border-radius: 6px; margin-bottom: 8px; }
        .api-dot { width: 8px; height: 8px; border-radius: 50%; }
        .api-dot.connected { background: var(--accent-green); }
        .api-dot.disconnected { background: var(--accent-red); }
        
        .error-banner { background: rgba(248, 113, 113, 0.1); border: 1px solid var(--accent-red); border-radius: 8px; padding: 16px; margin-bottom: 24px; color: var(--accent-red); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.3s ease forwards; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // API Configuration
        const API_BASE = window.location.origin + '/api';
        
        // API Client
        const api = {
            async health() {
                const res = await fetch(`${API_BASE}/health`);
                return res.json();
            },
            
            async createRFP(data) {
                const res = await fetch(`${API_BASE}/rfp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return res.json();
            },
            
            async uploadFiles(rfpId, files) {
                const formData = new FormData();
                files.forEach(f => formData.append('files', f));
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/upload`, {
                    method: 'POST',
                    body: formData
                });
                return res.json();
            },

            async uploadFilesGuided(rfpId, files, docTypes) {
                const formData = new FormData();
                files.forEach(f => formData.append('files', f));
                formData.append('doc_types', docTypes);
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/upload-guided`, {
                    method: 'POST',
                    body: formData
                });
                return res.json();
            },

            async processRFP(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/process`, { method: 'POST' });
                return res.json();
            },
            
            async processRFPSemantic(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/process-semantic`, { method: 'POST' });
                return res.json();
            },
            
            async processRFPBestPractices(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/process-best-practices`, { method: 'POST' });
                return res.json();
            },
            
            async getStatus(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/status`);
                return res.json();
            },
            
            async getRFP(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}`);
                return res.json();
            },
            
            async getRequirements(rfpId, params = {}) {
                const query = new URLSearchParams(params).toString();
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/requirements?${query}`);
                return res.json();
            },
            
            async exportExcel(rfpId) {
                window.open(`${API_BASE}/rfp/${rfpId}/export?format=xlsx`, '_blank');
            },
            
            async getAmendments(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/amendments`);
                return res.json();
            },
            
            async getOutline(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/outline`);
                return res.json();
            },
            
            async exportOutline(rfpId) {
                window.open(`${API_BASE}/rfp/${rfpId}/outline/export`, '_blank');
            },
            
            async generateOutline(rfpId) {
                const res = await fetch(`${API_BASE}/rfp/${rfpId}/outline`, { method: 'POST' });
                return res.json();
            }
        };
        
        // Icon component
        function Icon({ name, size = 20 }) {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current && lucide.icons[name]) {
                    ref.current.innerHTML = '';
                    const icon = lucide.createElement(lucide.icons[name]);
                    ref.current.appendChild(icon);
                }
            }, [name]);
            return <span ref={ref} style={{ display: 'inline-flex', width: size, height: size }} />;
        }
        
        // Main App
        function App() {
            const [currentView, setCurrentView] = useState('upload');
            const [apiConnected, setApiConnected] = useState(false);
            const [error, setError] = useState(null);
            
            // RFP State
            const [currentRfpId, setCurrentRfpId] = useState(null);
            const [files, setFiles] = useState([]);
            const [rawFiles, setRawFiles] = useState([]);
            const [processing, setProcessing] = useState(false);
            const [processingStatus, setProcessingStatus] = useState({ status: '', progress: 0, message: '' });
            const [extractionMode, setExtractionMode] = useState('standard'); // v2.9: Default to best practices
            
            // Requirements State
            const [requirements, setRequirements] = useState([]);
            const [stats, setStats] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterType, setFilterType] = useState('all');
            const [filterPriority, setFilterPriority] = useState('all');
            
            // Check API health on mount
            useEffect(() => {
                const checkHealth = async () => {
                    try {
                        await api.health();
                        setApiConnected(true);
                    } catch (e) {
                        setApiConnected(false);
                    }
                };
                checkHealth();
                const interval = setInterval(checkHealth, 30000);
                return () => clearInterval(interval);
            }, []);
            
            // Poll for status while processing
            useEffect(() => {
                if (!processing || !currentRfpId) return;
                
                const pollStatus = async () => {
                    try {
                        const status = await api.getStatus(currentRfpId);
                        setProcessingStatus(status);
                        
                        if (status.status === 'completed') {
                            setProcessing(false);
                            await loadRequirements();
                            setCurrentView('matrix');
                        } else if (status.status === 'error') {
                            setProcessing(false);
                            setError(status.message);
                        }
                    } catch (e) {
                        console.error('Status poll error:', e);
                    }
                };
                
                const interval = setInterval(pollStatus, 1000);
                return () => clearInterval(interval);
            }, [processing, currentRfpId]);
            
            // Load requirements
            const loadRequirements = async () => {
                if (!currentRfpId) return;
                
                try {
                    const [rfpData, reqData] = await Promise.all([
                        api.getRFP(currentRfpId),
                        api.getRequirements(currentRfpId)
                    ]);
                    
                    setRequirements(reqData.requirements || []);
                    setStats(rfpData.stats);
                } catch (e) {
                    setError('Failed to load requirements: ' + e.message);
                }
            };
            
            // Process files - accepts optional docTypes and files from guided upload
            const processFiles = async (docTypes = '', filesToProcess = null) => {
                // Use provided files or fall back to rawFiles state
                const files = filesToProcess || rawFiles;

                if (files.length === 0) {
                    setError('Please upload files first');
                    return;
                }

                setError(null);
                setProcessing(true);
                setProcessingStatus({ status: 'starting', progress: 0, message: 'Creating RFP project...' });

                try {
                    // Create RFP
                    const rfp = await api.createRFP({
                        name: files[0]?.name?.replace(/\.[^/.]+$/, '') || 'New RFP',
                        solicitation_number: null,
                        agency: null
                    });

                    setCurrentRfpId(rfp.id);
                    setProcessingStatus({ status: 'uploading', progress: 20, message: 'Uploading files...' });

                    // Upload files with document types if provided
                    if (docTypes) {
                        await api.uploadFilesGuided(rfp.id, files, docTypes);
                    } else {
                        await api.uploadFiles(rfp.id, files);
                    }
                    setProcessingStatus({ status: 'processing', progress: 40, message: 'Starting processing...' });

                    // Start processing
                    if (extractionMode === 'best_practices') {
                        await api.processRFPBestPractices(rfp.id);
                    } else if (extractionMode === 'semantic') {
                        await api.processRFPSemantic(rfp.id);
                    } else {
                        await api.processRFP(rfp.id);
                    }

                    // Status polling will take over from here

                } catch (e) {
                    setProcessing(false);
                    setError('Processing failed: ' + e.message);
                }
            };
            
            // Export to Excel
            const exportToExcel = () => {
                if (currentRfpId) {
                    api.exportExcel(currentRfpId);
                }
            };
            
            // Filter requirements
            const filteredRequirements = requirements.filter(req => {
                const matchesSearch = searchQuery === '' || 
                    req.text?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    req.id?.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesType = filterType === 'all' || req.type === filterType;
                const matchesPriority = filterPriority === 'all' || req.priority === filterPriority;
                return matchesSearch && matchesType && matchesPriority;
            });
            
            return (
                <div className="app-container">
                    {/* Sidebar */}
                    <aside className="sidebar">
                        <div className="logo">
                            <h1>PropelAI</h1>
                            <span>RFP Intelligence</span>
                        </div>
                        
                        <nav className="nav-section">
                            <div className="api-status">
                                <span className={`api-dot ${apiConnected ? 'connected' : 'disconnected'}`}></span>
                                <span style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                    {apiConnected ? 'API Connected' : 'API Offline'}
                                </span>
                            </div>
                            
                            <div className="nav-label">Workspace</div>
                            <div 
                                className={`nav-item ${currentView === 'upload' ? 'active' : ''}`}
                                onClick={() => setCurrentView('upload')}
                            >
                                <Icon name="Upload" />
                                <span>Upload RFP</span>
                            </div>
                            <div 
                                className={`nav-item ${currentView === 'matrix' ? 'active' : ''} ${!stats ? 'disabled' : ''}`}
                                onClick={() => stats && setCurrentView('matrix')}
                            >
                                <Icon name="Table" />
                                <span>Compliance Matrix</span>
                            </div>
                            <div 
                                className={`nav-item ${currentView === 'amendments' ? 'active' : ''} ${!stats ? 'disabled' : ''}`}
                                onClick={() => stats && setCurrentView('amendments')}
                            >
                                <Icon name="GitBranch" />
                                <span>Amendments</span>
                            </div>
                            <div 
                                className={`nav-item ${currentView === 'outline' ? 'active' : ''} ${!stats ? 'disabled' : ''}`}
                                onClick={() => stats && setCurrentView('outline')}
                            >
                                <Icon name="FileText" />
                                <span>Proposal Outline</span>
                            </div>
                            
                            <div className="nav-label" style={{ marginTop: 24 }}>Company Library</div>
                            <div 
                                className={`nav-item ${currentView === 'library' ? 'active' : ''}`}
                                onClick={() => setCurrentView('library')}
                            >
                                <Icon name="Building" />
                                <span>Library</span>
                            </div>
                            
                            <div className="nav-label" style={{ marginTop: 24 }}>Workspace</div>
                            <div
                                className={`nav-item ${currentView === 'teams' ? 'active' : ''}`}
                                onClick={() => setCurrentView('teams')}
                            >
                                <Icon name="Users" />
                                <span>Teams</span>
                            </div>

                            <div className="nav-label" style={{ marginTop: 24 }}>Coming Soon</div>
                            <div className="nav-item disabled">
                                <Icon name="Target" />
                                <span>Win Themes</span>
                            </div>
                        </nav>
                        
                        <div className="sidebar-footer">
                            <p>PropelAI v4.1</p>
                            {currentRfpId && <p style={{ marginTop: 4 }}>{currentRfpId}</p>}
                        </div>
                    </aside>
                    
                    {/* Main Content */}
                    <main className="main-content">
                        {error && (
                            <div className="error-banner">
                                <strong>Error:</strong> {error}
                                <button 
                                    onClick={() => setError(null)} 
                                    style={{ float: 'right', background: 'none', border: 'none', color: 'inherit', cursor: 'pointer' }}
                                >
                                    âœ•
                                </button>
                            </div>
                        )}
                        
                        {currentView === 'upload' && (
                            <GuidedUploadView
                                files={files}
                                setFiles={setFiles}
                                rawFiles={rawFiles}
                                setRawFiles={setRawFiles}
                                onProcess={processFiles}
                                apiConnected={apiConnected}
                                extractionMode={extractionMode}
                                setExtractionMode={setExtractionMode}
                            />
                        )}
                        
                        {currentView === 'matrix' && stats && (
                            <MatrixView 
                                requirements={filteredRequirements}
                                allRequirements={requirements}
                                stats={stats}
                                searchQuery={searchQuery}
                                setSearchQuery={setSearchQuery}
                                filterType={filterType}
                                setFilterType={setFilterType}
                                filterPriority={filterPriority}
                                setFilterPriority={setFilterPriority}
                                onExport={exportToExcel}
                            />
                        )}
                        
                        {currentView === 'amendments' && stats && (
                            <AmendmentsView rfpId={currentRfpId} />
                        )}
                        
                        {currentView === 'outline' && stats && (
                            <OutlineView rfpId={currentRfpId} />
                        )}
                        
                        {currentView === 'library' && (
                            <LibraryView />
                        )}

                        {currentView === 'teams' && (
                            <TeamsView />
                        )}
                    </main>
                    
                    {/* Processing Overlay */}
                    {processing && (
                        <div className="processing-overlay">
                            <div className="processing-card animate-in">
                                <div className="spinner"></div>
                                <h3>Processing RFP</h3>
                                <p>{processingStatus.message}</p>
                                <div className="progress-bar">
                                    <div className="progress-fill" style={{ width: `${processingStatus.progress}%` }}></div>
                                </div>
                                <p style={{ marginTop: 16, fontSize: 12, color: 'var(--text-muted)' }}>
                                    {processingStatus.requirements_count ? `${processingStatus.requirements_count} requirements found` : ''}
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // Upload View
        function UploadView({ files, setFiles, rawFiles, setRawFiles, onProcess, apiConnected, extractionMode, setExtractionMode }) {
            const [dragging, setDragging] = useState(false);
            const fileInputRef = useRef(null);
            
            const handleDrop = (e) => {
                e.preventDefault();
                setDragging(false);
                const droppedFiles = Array.from(e.dataTransfer.files);
                addFiles(droppedFiles);
            };
            
            const handleFileSelect = (e) => {
                const selectedFiles = Array.from(e.target.files);
                addFiles(selectedFiles);
            };
            
            const addFiles = (newFiles) => {
                const validFiles = newFiles.filter(f => {
                    const ext = f.name.split('.').pop().toLowerCase();
                    return ['pdf', 'docx', 'xlsx', 'doc', 'xls'].includes(ext);
                });
                
                const fileData = validFiles.map(f => ({
                    name: f.name,
                    size: formatFileSize(f.size),
                    type: f.name.split('.').pop().toUpperCase(),
                    status: 'ready'
                }));
                
                setFiles([...files, ...fileData]);
                setRawFiles([...rawFiles, ...validFiles]);
            };
            
            const removeFile = (index) => {
                setFiles(files.filter((_, i) => i !== index));
                setRawFiles(rawFiles.filter((_, i) => i !== index));
            };
            
            const clearAll = () => {
                setFiles([]);
                setRawFiles([]);
            };
            
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Upload RFP Documents</h2>
                        <p>Upload your RFP package to extract requirements and build a compliance matrix</p>
                    </div>
                    
                    <div 
                        className={`upload-zone ${dragging ? 'dragging' : ''}`}
                        onDragOver={(e) => { e.preventDefault(); setDragging(true); }}
                        onDragLeave={() => setDragging(false)}
                        onDrop={handleDrop}
                        onClick={() => fileInputRef.current?.click()}
                    >
                        <input
                            ref={fileInputRef}
                            type="file"
                            multiple
                            accept=".pdf,.docx,.xlsx,.doc,.xls"
                            onChange={handleFileSelect}
                            style={{ display: 'none' }}
                        />
                        <div className="upload-icon">
                            <Icon name="Upload" size={28} />
                        </div>
                        <h3>Drop files here or click to browse</h3>
                        <p>Upload RFP documents, amendments, attachments, and Q&A files</p>
                        <div className="file-types">
                            <span className="file-type">.pdf</span>
                            <span className="file-type">.docx</span>
                            <span className="file-type">.xlsx</span>
                        </div>
                    </div>
                    
                    {files.length > 0 && (
                        <div className="file-list">
                            {files.map((file, index) => (
                                <div key={index} className="file-item">
                                    <div className="file-icon">
                                        <Icon name="FileText" />
                                    </div>
                                    <div className="file-info">
                                        <div className="file-name">{file.name}</div>
                                        <div className="file-meta">{file.type} Â· {file.size}</div>
                                    </div>
                                    <div className="file-status">
                                        <span className="badge badge-green">Ready</span>
                                        <button 
                                            className="btn btn-ghost"
                                            onClick={(e) => { e.stopPropagation(); removeFile(index); }}
                                        >
                                            <Icon name="X" size={16} />
                                        </button>
                                    </div>
                                </div>
                            ))}
                            
                            <div style={{ marginTop: 24, display: 'flex', gap: 12, alignItems: 'center', flexWrap: 'wrap' }}>
                                <button 
                                    className="btn btn-primary" 
                                    onClick={onProcess}
                                    disabled={!apiConnected}
                                >
                                    <Icon name="Zap" />
                                    {apiConnected ? 'Process RFP' : 'API Offline'}
                                </button>
                                <button className="btn btn-secondary" onClick={clearAll}>
                                    Clear All
                                </button>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginLeft: 16 }}>
                                    <span style={{ color: 'var(--text-secondary)', fontSize: 13 }}>
                                        Extraction Mode:
                                    </span>
                                    <select 
                                        value={extractionMode}
                                        onChange={(e) => setExtractionMode(e.target.value)}
                                        style={{ 
                                            background: 'var(--bg-secondary)', 
                                            border: '1px solid var(--border-color)',
                                            borderRadius: 6,
                                            padding: '6px 12px',
                                            color: 'var(--text-primary)',
                                            fontSize: 13,
                                            cursor: 'pointer'
                                        }}
                                    >
                                        <option value="best_practices">v2.9 Best Practices CTM</option>
                                        <option value="semantic">v2.8 Semantic</option>
                                        <option value="legacy">Legacy</option>
                                    </select>
                                    {extractionMode === 'best_practices' && (
                                        <span 
                                            style={{ 
                                                fontSize: 10, 
                                                background: 'var(--accent-green)', 
                                                color: 'black', 
                                                padding: '2px 6px', 
                                                borderRadius: 4,
                                                fontWeight: 600
                                            }}
                                        >
                                            NEW
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Guided Upload View - helps new proposal managers upload the right documents
        function GuidedUploadView({ files, setFiles, rawFiles, setRawFiles, onProcess, apiConnected, extractionMode, setExtractionMode }) {
            const [uploadConfig, setUploadConfig] = useState(null);
            const [slotFiles, setSlotFiles] = useState({});  // { slotId: { file, rawFile } }
            const [notApplicable, setNotApplicable] = useState(new Set());
            const [loading, setLoading] = useState(true);
            const [showHelp, setShowHelp] = useState(null);
            const fileInputRefs = useRef({});

            // Fetch upload config on mount
            useEffect(() => {
                fetch('/api/upload-config')
                    .then(res => res.json())
                    .then(config => {
                        setUploadConfig(config);
                        setLoading(false);
                    })
                    .catch(() => setLoading(false));
            }, []);

            const handleSlotDrop = (slotId, allowsMultiple) => (e) => {
                e.preventDefault();
                const droppedFiles = Array.from(e.dataTransfer.files);
                if (droppedFiles.length > 0) {
                    const file = droppedFiles[0];
                    addFileToSlot(slotId, file, allowsMultiple);
                }
            };

            const handleSlotSelect = (slotId, allowsMultiple) => (e) => {
                const selectedFiles = Array.from(e.target.files);
                if (selectedFiles.length > 0) {
                    addFileToSlot(slotId, selectedFiles[0], allowsMultiple);
                }
            };

            const addFileToSlot = (slotId, file, allowsMultiple) => {
                const ext = file.name.split('.').pop().toLowerCase();
                if (!['pdf', 'docx', 'xlsx', 'doc', 'xls'].includes(ext)) return;

                const fileData = {
                    name: file.name,
                    size: formatFileSize(file.size),
                    type: ext.toUpperCase()
                };

                if (allowsMultiple) {
                    const existing = slotFiles[slotId] || [];
                    setSlotFiles({
                        ...slotFiles,
                        [slotId]: [...existing, { file: fileData, rawFile: file }]
                    });
                } else {
                    setSlotFiles({
                        ...slotFiles,
                        [slotId]: [{ file: fileData, rawFile: file }]
                    });
                }

                // Remove from not applicable
                if (notApplicable.has(slotId)) {
                    const newNA = new Set(notApplicable);
                    newNA.delete(slotId);
                    setNotApplicable(newNA);
                }
            };

            const removeFileFromSlot = (slotId, index) => {
                const existing = slotFiles[slotId] || [];
                setSlotFiles({
                    ...slotFiles,
                    [slotId]: existing.filter((_, i) => i !== index)
                });
            };

            const toggleNotApplicable = (slotId) => {
                const newNA = new Set(notApplicable);
                if (newNA.has(slotId)) {
                    newNA.delete(slotId);
                } else {
                    newNA.add(slotId);
                    // Clear files from this slot
                    setSlotFiles({ ...slotFiles, [slotId]: [] });
                }
                setNotApplicable(newNA);
            };

            const handleProcess = () => {
                // Collect all files with their doc types
                const allFiles = [];
                const docTypes = [];

                Object.entries(slotFiles).forEach(([slotId, fileList]) => {
                    (fileList || []).forEach(({ rawFile }) => {
                        allFiles.push(rawFile);
                        docTypes.push(slotId);
                    });
                });

                if (allFiles.length === 0) return;

                // Update parent state for display purposes
                const fileData = allFiles.map(f => ({
                    name: f.name,
                    size: formatFileSize(f.size),
                    type: f.name.split('.').pop().toUpperCase(),
                    status: 'ready'
                }));

                setFiles(fileData);
                setRawFiles(allFiles);

                // Pass files directly to avoid React state timing issues
                onProcess(docTypes.join(','), allFiles);
            };

            const getTotalFiles = () => {
                return Object.values(slotFiles).reduce((acc, files) => acc + (files?.length || 0), 0);
            };

            const hasRequiredFiles = () => {
                if (!uploadConfig) return false;
                const requiredSlots = uploadConfig.upload_slots.filter(s => s.required);
                return requiredSlots.every(slot =>
                    (slotFiles[slot.id]?.length > 0) || notApplicable.has(slot.id)
                );
            };

            if (loading) {
                return <div style={{ textAlign: 'center', padding: 40 }}>Loading...</div>;
            }

            if (!uploadConfig?.guided_mode_available) {
                return <UploadView
                    files={files} setFiles={setFiles}
                    rawFiles={rawFiles} setRawFiles={setRawFiles}
                    onProcess={onProcess} apiConnected={apiConnected}
                    extractionMode={extractionMode} setExtractionMode={setExtractionMode}
                />;
            }

            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Upload RFP Documents</h2>
                        <p>Only the Technical Requirements (SOW/PWS) is required. Add other documents for better proposal structure guidance.</p>
                    </div>

                    <div className="guided-upload-grid">
                        {uploadConfig.upload_slots.map(slot => {
                            const slotFileList = slotFiles[slot.id] || [];
                            const isNA = notApplicable.has(slot.id);
                            const hasFiles = slotFileList.length > 0;

                            return (
                                <div
                                    key={slot.id}
                                    className={`upload-slot ${slot.required ? 'required' : ''} ${hasFiles ? 'has-file' : ''} ${isNA ? 'not-applicable' : ''}`}
                                    onDragOver={(e) => e.preventDefault()}
                                    onDrop={!isNA ? handleSlotDrop(slot.id, slot.allows_multiple) : undefined}
                                    onClick={() => !isNA && fileInputRefs.current[slot.id]?.click()}
                                    style={{ cursor: isNA ? 'default' : 'pointer' }}
                                >
                                    <input
                                        ref={el => fileInputRefs.current[slot.id] = el}
                                        type="file"
                                        accept=".pdf,.docx,.xlsx,.doc,.xls"
                                        onChange={handleSlotSelect(slot.id, slot.allows_multiple)}
                                        style={{ display: 'none' }}
                                    />

                                    <div className="slot-header">
                                        <div className="slot-icon" style={{ background: `${slot.color}20` }}>
                                            {slot.icon}
                                        </div>
                                        <div>
                                            <div className="slot-title">{slot.title}</div>
                                            <div className="slot-description">{slot.description}</div>
                                        </div>
                                    </div>

                                    {!isNA && !hasFiles && (
                                        <div className="slot-help">
                                            <strong>Look for:</strong> {slot.common_names.slice(0, 3).join(', ')}
                                            {slot.common_names.length > 3 && '...'}
                                            <button
                                                className="btn btn-ghost"
                                                onClick={(e) => { e.stopPropagation(); setShowHelp(showHelp === slot.id ? null : slot.id); }}
                                                style={{ marginLeft: 8, padding: '2px 6px', fontSize: 11 }}
                                            >
                                                ?
                                            </button>
                                        </div>
                                    )}

                                    {showHelp === slot.id && (
                                        <div style={{
                                            marginTop: 12,
                                            padding: 12,
                                            background: 'var(--bg-secondary)',
                                            borderRadius: 8,
                                            fontSize: 12,
                                            lineHeight: 1.6,
                                            whiteSpace: 'pre-wrap'
                                        }}>
                                            {slot.help_text}
                                        </div>
                                    )}

                                    {hasFiles && slotFileList.map((item, idx) => (
                                        <div key={idx} className="slot-file">
                                            <Icon name="FileText" size={16} />
                                            <span className="slot-file-name">{item.file.name}</span>
                                            <span style={{ color: 'var(--text-muted)', fontSize: 11 }}>{item.file.size}</span>
                                            <button
                                                className="slot-file-remove"
                                                onClick={(e) => { e.stopPropagation(); removeFileFromSlot(slot.id, idx); }}
                                            >
                                                <Icon name="X" size={14} />
                                            </button>
                                        </div>
                                    ))}

                                    {isNA && (
                                        <div style={{ marginTop: 12, color: 'var(--text-muted)', fontSize: 12 }}>
                                            Marked as not applicable
                                        </div>
                                    )}

                                    {slot.show_not_applicable && !hasFiles && (
                                        <button
                                            className="slot-na-btn"
                                            onClick={(e) => { e.stopPropagation(); toggleNotApplicable(slot.id); }}
                                        >
                                            {isNA ? 'Enable this slot' : 'Not applicable for this RFP'}
                                        </button>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                    {/* Skip Documents Warning */}
                    <div className="skip-docs-section">
                        <div className="skip-docs-title">
                            <Icon name="AlertCircle" size={14} />
                            Don't upload these documents
                        </div>
                        <p style={{ fontSize: 12, color: 'var(--text-secondary)', marginBottom: 10 }}>
                            These files don't contain proposal requirements and may reduce extraction accuracy:
                        </p>
                        <div className="skip-docs-list">
                            {uploadConfig.skip_documents.map((doc, i) => (
                                <span key={i} className="skip-doc-tag" title={doc.description}>
                                    {doc.name}
                                </span>
                            ))}
                        </div>
                    </div>

                    {/* Quick Start Guide */}
                    {uploadConfig.quick_start_tips && (
                        <div className="quick-start-guide" style={{
                            marginTop: 16,
                            padding: 16,
                            background: 'rgba(99, 102, 241, 0.08)',
                            border: '1px solid rgba(99, 102, 241, 0.2)',
                            borderRadius: 10
                        }}>
                            <div style={{ fontWeight: 600, marginBottom: 12, display: 'flex', alignItems: 'center', gap: 8 }}>
                                <Icon name="Lightbulb" size={16} />
                                Quick Start Guide
                            </div>
                            <div style={{ display: 'grid', gap: 10 }}>
                                {uploadConfig.quick_start_tips.map((tip, i) => (
                                    <div key={i} style={{
                                        display: 'grid',
                                        gridTemplateColumns: '1fr 1.5fr',
                                        gap: 12,
                                        alignItems: 'start',
                                        fontSize: 12,
                                        padding: '8px 0',
                                        borderBottom: i < uploadConfig.quick_start_tips.length - 1 ? '1px solid rgba(99, 102, 241, 0.15)' : 'none'
                                    }}>
                                        <div>
                                            <strong style={{ color: 'var(--accent-purple)' }}>{tip.scenario}</strong>
                                            <div style={{ color: 'var(--text-muted)', marginTop: 2 }}>{tip.examples}</div>
                                        </div>
                                        <div style={{ color: 'var(--text-secondary)' }}>â†’ {tip.action}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Tips */}
                    <div className="upload-tips">
                        <div className="upload-tips-title">Tips for Best Results</div>
                        <ul>
                            {uploadConfig.tips.map((tip, i) => (
                                <li key={i}>{tip}</li>
                            ))}
                        </ul>
                    </div>

                    {/* Process Button */}
                    <div style={{ marginTop: 24, display: 'flex', gap: 12, alignItems: 'center', flexWrap: 'wrap' }}>
                        <button
                            className="btn btn-primary"
                            onClick={handleProcess}
                            disabled={!apiConnected || getTotalFiles() === 0}
                        >
                            <Icon name="Zap" />
                            {getTotalFiles() > 0
                                ? `Process ${getTotalFiles()} Document${getTotalFiles() > 1 ? 's' : ''}`
                                : 'Upload documents to continue'
                            }
                        </button>
                        {!hasRequiredFiles() && getTotalFiles() > 0 && (
                            <span style={{ fontSize: 12, color: 'var(--accent-amber)' }}>
                                âš ï¸ Missing required document (Technical Requirements / SOW / PWS)
                            </span>
                        )}
                    </div>
                </div>
            );
        }

        // Matrix View
        function MatrixView({ 
            requirements, allRequirements, stats, 
            searchQuery, setSearchQuery, 
            filterType, setFilterType,
            filterPriority, setFilterPriority,
            onExport
        }) {
            const uniqueTypes = [...new Set(allRequirements.map(r => r.type).filter(Boolean))];
            
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Compliance Matrix</h2>
                        <p>Extracted {stats?.total || allRequirements.length} requirements from your RFP documents</p>
                    </div>
                    
                    {/* RFP Format Note (for GSA/BPA) */}
                    {stats?.is_non_ucf_format && (
                        <div style={{
                            background: 'rgba(251, 146, 60, 0.1)',
                            border: '1px solid rgba(251, 146, 60, 0.3)',
                            borderRadius: '8px',
                            padding: '12px 16px',
                            marginBottom: '20px',
                            display: 'flex',
                            alignItems: 'flex-start',
                            gap: '12px'
                        }}>
                            <span style={{ color: '#fb923c', fontSize: '18px' }}>â„¹ï¸</span>
                            <div>
                                <div style={{ fontWeight: '600', color: '#fb923c', marginBottom: '4px' }}>
                                    GSA Schedule / BPA Format Detected
                                </div>
                                <div style={{ fontSize: '13px', color: 'rgba(255,255,255,0.7)' }}>
                                    This RFP does not follow the standard UCF format (Sections L/M/C). 
                                    Submission instructions are in <strong>Section M Alignment</strong> ({stats?.evaluation || 0} items). 
                                    Technical requirements are in the <strong>PWS/SOW</strong> ({stats?.technical || 0} items).
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Stats */}
                    <div className="stats-grid">
                        <div className="stat-card blue">
                            <div className="label">Total Requirements</div>
                            <div className="value">{stats?.total || allRequirements.length}</div>
                        </div>
                        <div className="stat-card red">
                            <div className="label">High Priority</div>
                            <div className="value">{stats?.by_priority?.high || 0}</div>
                        </div>
                        <div className="stat-card amber">
                            <div className="label">Medium Priority</div>
                            <div className="value">{stats?.by_priority?.medium || 0}</div>
                        </div>
                        <div className="stat-card green">
                            <div className="label">Low Priority</div>
                            <div className="value">{stats?.by_priority?.low || 0}</div>
                        </div>
                    </div>
                    
                    {/* Actions */}
                    <div className="actions-bar">
                        <div className="search-box">
                            <Icon name="Search" />
                            <input 
                                type="text"
                                placeholder="Search requirements..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>
                        <div className="filter-group">
                            <select value={filterType} onChange={(e) => setFilterType(e.target.value)}>
                                <option value="all">All Types</option>
                                {uniqueTypes.map(type => (
                                    <option key={type} value={type}>{type}</option>
                                ))}
                            </select>
                            <select value={filterPriority} onChange={(e) => setFilterPriority(e.target.value)}>
                                <option value="all">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                            <button className="btn btn-primary" onClick={onExport}>
                                <Icon name="Download" />
                                Export Excel
                            </button>
                        </div>
                    </div>
                    
                    {/* Table */}
                    <div className="card">
                        <div className="table-container" style={{ maxHeight: '500px', overflow: 'auto' }}>
                            <table>
                                <thead>
                                    <tr>
                                        <th style={{ width: 100 }}>ID</th>
                                        <th>Requirement</th>
                                        <th style={{ width: 100 }}>Section</th>
                                        <th style={{ width: 120 }}>Type</th>
                                        <th style={{ width: 100 }}>Priority</th>
                                        <th style={{ width: 80 }}>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {requirements.map((req, idx) => (
                                        <tr key={req.id || idx}>
                                            <td><span className="req-id">{req.id}</span></td>
                                            <td className="req-text" title={req.text}>{req.text}</td>
                                            <td>{req.section}</td>
                                            <td><span className={`badge badge-${getTypeBadgeColor(req.type)}`}>{req.type}</span></td>
                                            <td>
                                                <span className={`priority-dot priority-${req.priority}`}></span>
                                                {req.priority}
                                            </td>
                                            <td>{Math.round((req.confidence || 0) * 100)}%</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style={{ marginTop: 16, color: 'var(--text-muted)', fontSize: 14 }}>
                        Showing {requirements.length} of {allRequirements.length} requirements
                        {stats?.processing_time && ` Â· Processed in ${stats.processing_time.toFixed(2)}s`}
                    </div>
                </div>
            );
        }
        
        // Amendments View
        function AmendmentsView({ rfpId }) {
            const [amendments, setAmendments] = useState([]);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                if (rfpId) {
                    api.getAmendments(rfpId).then(data => {
                        setAmendments(data.amendments || []);
                        setLoading(false);
                    }).catch(() => setLoading(false));
                }
            }, [rfpId]);
            
            return (
                <div className="animate-in">
                    <div className="page-header">
                        <h2>Amendment Tracking</h2>
                        <p>Track changes across RFP versions and amendments</p>
                    </div>
                    
                    {loading ? (
                        <div style={{ textAlign: 'center', padding: 60, color: 'var(--text-muted)' }}>
                            Loading amendments...
                        </div>
                    ) : amendments.length === 0 ? (
                        <div className="card" style={{ textAlign: 'center', padding: 60 }}>
                            <Icon name="GitBranch" size={48} />
                            <h3 style={{ marginTop: 16, marginBottom: 8 }}>No Amendments Yet</h3>
                            <p style={{ color: 'var(--text-muted)' }}>
                                Upload amendment documents to track changes
                            </p>
                        </div>
                    ) : (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Amendment History</h3>
                            </div>
                            {amendments.map((a, idx) => (
                                <div key={idx} style={{ 
                                    padding: 16, 
                                    borderBottom: '1px solid var(--border-color)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: 16
                                }}>
                                    <div style={{ 
                                        width: 40, height: 40, 
                                        background: 'var(--bg-tertiary)', 
                                        borderRadius: 8,
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 600
                                    }}>
                                        {a.number}
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: 500 }}>Amendment {a.number}</div>
                                        <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>{a.date} Â· {a.file}</div>
                                    </div>
                                    <div style={{ display: 'flex', gap: 8 }}>
                                        <span className="badge badge-green">+{a.changes?.added || 0}</span>
                                        <span className="badge badge-amber">{a.changes?.modified || 0}</span>
                                        <span className="badge badge-red">-{a.changes?.deleted || 0}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        // Outline View
        function OutlineView({ rfpId }) {
            const [outline, setOutline] = useState(null);
            const [loading, setLoading] = useState(true);
            const [generating, setGenerating] = useState(false);
            const [activeVolume, setActiveVolume] = useState(null);
            
            useEffect(() => {
                if (rfpId) {
                    loadOutline();
                }
            }, [rfpId]);
            
            const loadOutline = async () => {
                setLoading(true);
                try {
                    const data = await api.getOutline(rfpId);
                    setOutline(data.outline);
                    if (data.outline?.volumes?.length > 0) {
                        setActiveVolume(data.outline.volumes[0].id);
                    }
                } catch (e) {
                    // Outline not generated yet
                    setOutline(null);
                } finally {
                    setLoading(false);
                }
            };
            
            const generateOutline = async () => {
                setGenerating(true);
                try {
                    const data = await api.generateOutline(rfpId);
                    setOutline(data.outline);
                    if (data.outline?.volumes?.length > 0) {
                        setActiveVolume(data.outline.volumes[0].id);
                    }
                } catch (e) {
                    console.error('Failed to generate outline:', e);
                } finally {
                    setGenerating(false);
                }
            };
            
            const getVolumeIcon = (type) => {
                const icons = {
                    technical: 'Cpu',
                    management: 'Users',
                    past_performance: 'Award',
                    cost_price: 'DollarSign',
                    staffing: 'UserCheck',
                    small_business: 'Building',
                    oral_presentation: 'Presentation',
                    other: 'FileText'
                };
                return icons[type] || 'FileText';
            };
            
            if (loading) {
                return (
                    <div className="animate-in" style={{ textAlign: 'center', padding: 60 }}>
                        <div className="spinner"></div>
                        <p style={{ marginTop: 16, color: 'var(--text-muted)' }}>Loading outline...</p>
                    </div>
                );
            }
            
            if (!outline) {
                return (
                    <div className="animate-in">
                        <div className="page-header">
                            <h2>Proposal Outline</h2>
                            <p>Generate a proposal outline from Section L/M</p>
                        </div>
                        
                        <div className="card" style={{ textAlign: 'center', padding: 60 }}>
                            <Icon name="FileText" size={48} />
                            <h3 style={{ marginTop: 16, marginBottom: 8 }}>Generate Proposal Outline</h3>
                            <p style={{ color: 'var(--text-muted)', marginBottom: 24 }}>
                                Parse Section L (Instructions) and Section M (Evaluation Factors) to create a proposal-ready outline
                            </p>
                            <button 
                                className="btn btn-primary" 
                                onClick={generateOutline}
                                disabled={generating}
                            >
                                {generating ? (
                                    <>
                                        <span className="spinner" style={{ width: 18, height: 18, borderWidth: 2 }}></span>
                                        Generating...
                                    </>
                                ) : (
                                    <>
                                        <Icon name="Zap" />
                                        Generate Outline
                                    </>
                                )}
                            </button>
                        </div>
                    </div>
                );
            }
            
            const activeVolumeData = outline.volumes?.find(v => v.id === activeVolume);
            
            return (
                <div className="animate-in">
                    <div className="page-header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                        <div>
                            <h2>Proposal Outline</h2>
                            <p>Structure your proposal based on RFP requirements</p>
                        </div>
                        <button 
                            className="btn btn-primary"
                            onClick={() => api.exportOutline(rfpId)}
                            title="Download annotated outline as Word document"
                        >
                            <Icon name="Download" />
                            Export Outline
                        </button>
                    </div>
                    
                    {/* Submission & Format Info */}
                    <div className="stats-grid" style={{ marginBottom: 24 }}>
                        <div className="stat-card">
                            <div className="label">Due Date</div>
                            <div className="value" style={{ fontSize: 18 }}>
                                {outline.submission?.due_date || 'TBD'}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Submission</div>
                            <div className="value" style={{ fontSize: 18, textTransform: 'capitalize' }}>
                                {outline.submission?.method || 'Not specified'}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Total Pages</div>
                            <div className="value" style={{ fontSize: 18 }}>
                                {outline.total_page_limit || 'No limit'}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="label">Volumes</div>
                            <div className="value" style={{ fontSize: 18 }}>
                                {outline.volumes?.length || 0}
                            </div>
                        </div>
                    </div>
                    
                    <div style={{ display: 'grid', gridTemplateColumns: '300px 1fr', gap: 24 }}>
                        {/* Volumes Sidebar */}
                        <div className="card" style={{ padding: 0 }}>
                            <div style={{ padding: 16, borderBottom: '1px solid var(--border-color)' }}>
                                <h3 style={{ fontSize: 14, fontWeight: 600 }}>Proposal Volumes</h3>
                            </div>
                            {outline.volumes?.map((vol) => (
                                <div 
                                    key={vol.id}
                                    onClick={() => setActiveVolume(vol.id)}
                                    style={{ 
                                        padding: 16, 
                                        borderBottom: '1px solid var(--border-color)',
                                        cursor: 'pointer',
                                        background: activeVolume === vol.id ? 'rgba(79, 140, 255, 0.1)' : 'transparent',
                                        borderLeft: activeVolume === vol.id ? '3px solid var(--accent-blue)' : '3px solid transparent'
                                    }}
                                >
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                        <Icon name={getVolumeIcon(vol.type)} size={18} />
                                        <div>
                                            <div style={{ fontWeight: 500, fontSize: 14 }}>{vol.name}</div>
                                            <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>
                                                {vol.page_limit ? `${vol.page_limit} pages` : 'No page limit'}
                                                {vol.sections?.length > 0 && ` Â· ${vol.sections.length} sections`}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        {/* Volume Detail */}
                        <div>
                            {/* Evaluation Factors */}
                            <div className="card" style={{ marginBottom: 24 }}>
                                <div className="card-header">
                                    <h3 className="card-title">Evaluation Factors</h3>
                                </div>
                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: 12 }}>
                                    {outline.evaluation_factors?.map((factor, idx) => (
                                        <div key={idx} style={{ 
                                            padding: '12px 16px', 
                                            background: 'var(--bg-tertiary)', 
                                            borderRadius: 8,
                                            flex: '1 1 200px'
                                        }}>
                                            <div style={{ fontWeight: 500, marginBottom: 4 }}>{factor.name}</div>
                                            {factor.weight && (
                                                <span className="badge badge-blue">
                                                    {factor.weight} {factor.weight_type || 'pts'}
                                                </span>
                                            )}
                                            {factor.importance && (
                                                <span className="badge badge-purple" style={{ marginLeft: 8 }}>
                                                    {factor.importance}
                                                </span>
                                            )}
                                            {factor.subfactors?.length > 0 && (
                                                <div style={{ marginTop: 8, fontSize: 12, color: 'var(--text-secondary)' }}>
                                                    {factor.subfactors.map((sf, i) => (
                                                        <div key={i}>â€¢ {sf.name}</div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            {/* Active Volume Sections */}
                            {activeVolumeData && (
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">{activeVolumeData.name} - Sections</h3>
                                        {activeVolumeData.page_limit && (
                                            <span className="badge badge-blue">{activeVolumeData.page_limit} pages</span>
                                        )}
                                    </div>
                                    
                                    {activeVolumeData.sections?.length > 0 ? (
                                        activeVolumeData.sections.map((section, idx) => (
                                            <div key={idx} style={{ 
                                                padding: 16, 
                                                borderBottom: '1px solid var(--border-color)'
                                            }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                                                    <div>
                                                        <div style={{ fontWeight: 500, marginBottom: 8 }}>{section.title}</div>
                                                        
                                                        {section.content_requirements?.length > 0 && (
                                                            <div style={{ marginBottom: 8 }}>
                                                                <div style={{ fontSize: 11, color: 'var(--text-muted)', marginBottom: 4 }}>CONTENT REQUIREMENTS</div>
                                                                {section.content_requirements.slice(0, 2).map((req, i) => (
                                                                    <div key={i} style={{ fontSize: 13, color: 'var(--text-secondary)', marginBottom: 2 }}>
                                                                        â€¢ {req.slice(0, 150)}{req.length > 150 ? '...' : ''}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                        
                                                        {section.compliance_checkpoints?.length > 0 && (
                                                            <div>
                                                                <div style={{ fontSize: 11, color: 'var(--text-muted)', marginBottom: 4 }}>CHECKLIST</div>
                                                                {section.compliance_checkpoints.slice(0, 3).map((cp, i) => (
                                                                    <div key={i} style={{ fontSize: 13, color: 'var(--text-secondary)' }}>
                                                                        {cp}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                    {section.page_limit && (
                                                        <span className="badge badge-gray">{section.page_limit}p</span>
                                                    )}
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div style={{ padding: 24, textAlign: 'center', color: 'var(--text-muted)' }}>
                                            No detailed sections found for this volume
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {/* Warnings */}
                            {outline.warnings?.length > 0 && (
                                <div className="card" style={{ marginTop: 24, background: 'rgba(251, 191, 36, 0.1)', borderColor: 'var(--accent-amber)' }}>
                                    <div className="card-header">
                                        <h3 className="card-title" style={{ color: 'var(--accent-amber)' }}>âš ï¸ Warnings</h3>
                                    </div>
                                    {outline.warnings.map((warning, idx) => (
                                        <div key={idx} style={{ padding: '8px 16px', fontSize: 14 }}>
                                            {warning}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Company Library View
        function LibraryView() {
            const [library, setLibrary] = useState(null);
            const [loading, setLoading] = useState(true);
            const [uploading, setUploading] = useState(false);
            const [activeTab, setActiveTab] = useState('overview');
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const fileInputRef = useRef(null);
            
            useEffect(() => {
                loadLibrary();
            }, []);
            
            const loadLibrary = async () => {
                try {
                    const response = await fetch('/api/library');
                    const data = await response.json();
                    setLibrary(data);
                } catch (error) {
                    console.error('Error loading library:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                setUploading(true);
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch('/api/library/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success) {
                        loadLibrary();
                    }
                } catch (error) {
                    console.error('Error uploading:', error);
                } finally {
                    setUploading(false);
                    fileInputRef.current.value = '';
                }
            };
            
            const handleSearch = async () => {
                if (!searchQuery.trim()) return;
                
                try {
                    const response = await fetch(`/api/library/search?query=${encodeURIComponent(searchQuery)}`);
                    const data = await response.json();
                    setSearchResults(data.results || []);
                } catch (error) {
                    console.error('Error searching:', error);
                }
            };
            
            const deleteDocument = async (docId) => {
                if (!confirm('Remove this document from library?')) return;
                
                try {
                    await fetch(`/api/library/documents/${docId}`, { method: 'DELETE' });
                    loadLibrary();
                } catch (error) {
                    console.error('Error deleting:', error);
                }
            };
            
            if (loading) {
                return (
                    <div style={{ padding: 40, textAlign: 'center' }}>
                        <div className="spinner"></div>
                        <p style={{ marginTop: 16 }}>Loading library...</p>
                    </div>
                );
            }
            
            return (
                <div>
                    <div className="view-header">
                        <div>
                            <h1>Company Library</h1>
                            <p className="text-muted">Upload capabilities statements, past performance, and resumes for enhanced proposal generation</p>
                        </div>
                        <div>
                            <input
                                type="file"
                                ref={fileInputRef}
                                onChange={handleFileUpload}
                                accept=".docx,.doc,.pdf,.txt,.md"
                                style={{ display: 'none' }}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => fileInputRef.current.click()}
                                disabled={uploading}
                            >
                                {uploading ? 'Uploading...' : '+ Upload Document'}
                            </button>
                        </div>
                    </div>
                    
                    {/* Stats Cards */}
                    <div className="stats-grid" style={{ marginBottom: 24 }}>
                        <div className="stat-card">
                            <div className="stat-label">Documents</div>
                            <div className="stat-value">{library?.document_count || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Capabilities</div>
                            <div className="stat-value">{library?.profile_summary?.capabilities_count || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Differentiators</div>
                            <div className="stat-value">{library?.profile_summary?.differentiators_count || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Past Performance</div>
                            <div className="stat-value">{library?.profile_summary?.past_performance_count || 0}</div>
                        </div>
                    </div>
                    
                    {/* Tabs */}
                    <div style={{ display: 'flex', gap: 8, marginBottom: 16, borderBottom: '1px solid var(--border-color)', paddingBottom: 8 }}>
                        {['overview', 'documents', 'search', 'vector-search'].map(tab => (
                            <button
                                key={tab}
                                className={`btn ${activeTab === tab ? 'btn-primary' : ''}`}
                                onClick={() => setActiveTab(tab)}
                                style={{ textTransform: 'capitalize' }}
                            >
                                {tab === 'vector-search' ? 'AI Search' : tab}
                            </button>
                        ))}
                    </div>
                    
                    {activeTab === 'overview' && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">
                                    {library?.profile_summary?.company_name || 'Company Profile'}
                                </h3>
                            </div>
                            
                            {library?.document_count === 0 ? (
                                <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-muted)' }}>
                                    <Icon name="Building" style={{ width: 48, height: 48, marginBottom: 16, opacity: 0.5 }} />
                                    <p>No documents in library yet</p>
                                    <p style={{ fontSize: 13, marginTop: 8 }}>Upload a capabilities statement to get started</p>
                                </div>
                            ) : (
                                <div style={{ padding: 16 }}>
                                    <p style={{ marginBottom: 16 }}>
                                        Your library contains <strong>{library?.profile_summary?.capabilities_count || 0}</strong> capabilities, 
                                        <strong> {library?.profile_summary?.differentiators_count || 0}</strong> differentiators, and 
                                        <strong> {library?.profile_summary?.past_performance_count || 0}</strong> past performance records.
                                    </p>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>
                                        This content will be used to enhance your proposal drafts with relevant company information.
                                    </p>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {activeTab === 'documents' && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Uploaded Documents</h3>
                            </div>
                            
                            {library?.documents?.length === 0 ? (
                                <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-muted)' }}>
                                    No documents uploaded yet
                                </div>
                            ) : (
                                library?.documents?.map(doc => (
                                    <div key={doc.id} style={{ 
                                        padding: 16, 
                                        borderBottom: '1px solid var(--border-color)',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center'
                                    }}>
                                        <div>
                                            <div style={{ fontWeight: 500 }}>{doc.title}</div>
                                            <div style={{ fontSize: 13, color: 'var(--text-muted)', marginTop: 4 }}>
                                                <span className={`badge badge-${doc.type === 'capabilities' ? 'blue' : doc.type === 'resume' ? 'green' : 'purple'}`}>
                                                    {doc.type}
                                                </span>
                                                <span style={{ marginLeft: 8 }}>{doc.filename}</span>
                                            </div>
                                        </div>
                                        <button 
                                            className="btn"
                                            onClick={() => deleteDocument(doc.id)}
                                            style={{ color: 'var(--accent-red)' }}
                                        >
                                            Remove
                                        </button>
                                    </div>
                                ))
                            )}
                        </div>
                    )}
                    
                    {activeTab === 'search' && (
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Search Library</h3>
                            </div>
                            <div style={{ padding: 16 }}>
                                <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Search capabilities, differentiators, past performance..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                        style={{ flex: 1 }}
                                    />
                                    <button className="btn btn-primary" onClick={handleSearch}>
                                        Search
                                    </button>
                                </div>

                                {searchResults.length > 0 && (
                                    <div>
                                        <div style={{ fontSize: 13, color: 'var(--text-muted)', marginBottom: 12 }}>
                                            Found {searchResults.length} results
                                        </div>
                                        {searchResults.map((result, idx) => (
                                            <div key={idx} style={{
                                                padding: 12,
                                                background: 'var(--bg-tertiary)',
                                                borderRadius: 8,
                                                marginBottom: 8
                                            }}>
                                                <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 4 }}>
                                                    <span className={`badge badge-${result.type === 'capability' ? 'blue' : result.type === 'differentiator' ? 'purple' : 'green'}`}>
                                                        {result.type}
                                                    </span>
                                                    <span style={{ fontWeight: 500 }}>
                                                        {result.content.name || result.content.title || result.content.project_name}
                                                    </span>
                                                </div>
                                                <div style={{ fontSize: 13, color: 'var(--text-secondary)' }}>
                                                    {result.content.description?.slice(0, 200) || ''}
                                                    {result.content.description?.length > 200 ? '...' : ''}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {activeTab === 'vector-search' && (
                        <VectorSearchPanel />
                    )}
                </div>
            );
        }

        // Vector Search Panel Component
        function VectorSearchPanel() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [filters, setFilters] = useState({
                types: ['capability', 'past_performance', 'key_personnel', 'differentiator'],
                topK: 10
            });

            const handleVectorSearch = async () => {
                if (!query.trim()) return;

                setLoading(true);
                try {
                    const typesParam = filters.types.join(',');
                    const response = await fetch(
                        `/api/library/vector-search?query=${encodeURIComponent(query)}&top_k=${filters.topK}&types=${typesParam}`
                    );
                    const data = await response.json();
                    setResults(data.results || []);
                } catch (error) {
                    console.error('Vector search error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const toggleType = (type) => {
                setFilters(prev => ({
                    ...prev,
                    types: prev.types.includes(type)
                        ? prev.types.filter(t => t !== type)
                        : [...prev.types, type]
                }));
            };

            const typeLabels = {
                capability: { label: 'Capabilities', color: 'blue', icon: 'Zap' },
                past_performance: { label: 'Past Performance', color: 'green', icon: 'Award' },
                key_personnel: { label: 'Key Personnel', color: 'amber', icon: 'User' },
                differentiator: { label: 'Differentiators', color: 'purple', icon: 'Star' }
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title" style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                            <Icon name="Sparkles" style={{ color: 'var(--accent-purple)' }} />
                            AI-Powered Semantic Search
                        </h3>
                    </div>
                    <div style={{ padding: 16 }}>
                        <p style={{ color: 'var(--text-muted)', marginBottom: 16, fontSize: 14 }}>
                            Search using natural language. Our AI understands context and finds semantically similar content.
                        </p>

                        {/* Search Input */}
                        <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                            <input
                                type="text"
                                className="form-input"
                                placeholder="e.g., 'cloud migration experience with federal agencies' or 'cybersecurity certifications'"
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleVectorSearch()}
                                style={{ flex: 1 }}
                            />
                            <button
                                className="btn btn-primary"
                                onClick={handleVectorSearch}
                                disabled={loading}
                            >
                                {loading ? 'Searching...' : 'Search'}
                            </button>
                        </div>

                        {/* Filter Chips */}
                        <div style={{ display: 'flex', gap: 8, marginBottom: 16, flexWrap: 'wrap' }}>
                            {Object.entries(typeLabels).map(([type, info]) => (
                                <button
                                    key={type}
                                    className={`btn ${filters.types.includes(type) ? 'btn-primary' : ''}`}
                                    onClick={() => toggleType(type)}
                                    style={{
                                        fontSize: 12,
                                        padding: '6px 12px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: 4
                                    }}
                                >
                                    <Icon name={info.icon} style={{ width: 14, height: 14 }} />
                                    {info.label}
                                </button>
                            ))}
                            <select
                                value={filters.topK}
                                onChange={(e) => setFilters(prev => ({ ...prev, topK: parseInt(e.target.value) }))}
                                className="form-input"
                                style={{ width: 'auto', fontSize: 12, padding: '6px 12px' }}
                            >
                                <option value={5}>Top 5</option>
                                <option value={10}>Top 10</option>
                                <option value={20}>Top 20</option>
                            </select>
                        </div>

                        {/* Results */}
                        {results.length > 0 && (
                            <div>
                                <div style={{ fontSize: 13, color: 'var(--text-muted)', marginBottom: 12 }}>
                                    Found {results.length} semantic matches
                                </div>
                                {results.map((result, idx) => (
                                    <div key={idx} style={{
                                        padding: 16,
                                        background: 'var(--bg-tertiary)',
                                        borderRadius: 8,
                                        marginBottom: 12,
                                        border: '1px solid var(--border-color)'
                                    }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                                            <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
                                                <span className={`badge badge-${typeLabels[result.type]?.color || 'gray'}`}>
                                                    {typeLabels[result.type]?.label || result.type}
                                                </span>
                                                <span style={{ fontWeight: 600, fontSize: 15 }}>
                                                    {result.name || result.title || result.project_name}
                                                </span>
                                            </div>
                                            <span style={{
                                                fontSize: 12,
                                                color: 'var(--accent-green)',
                                                background: 'rgba(52, 211, 153, 0.1)',
                                                padding: '2px 8px',
                                                borderRadius: 4
                                            }}>
                                                {(result.similarity * 100).toFixed(0)}% match
                                            </span>
                                        </div>
                                        <div style={{ fontSize: 14, color: 'var(--text-secondary)', lineHeight: 1.6 }}>
                                            {result.description?.slice(0, 300) || result.bio?.slice(0, 300) || ''}
                                            {(result.description?.length > 300 || result.bio?.length > 300) ? '...' : ''}
                                        </div>
                                        {result.keywords && result.keywords.length > 0 && (
                                            <div style={{ marginTop: 8, display: 'flex', gap: 4, flexWrap: 'wrap' }}>
                                                {result.keywords.slice(0, 5).map((kw, i) => (
                                                    <span key={i} style={{
                                                        fontSize: 11,
                                                        padding: '2px 6px',
                                                        background: 'var(--bg-card)',
                                                        borderRadius: 4,
                                                        color: 'var(--text-muted)'
                                                    }}>
                                                        {kw}
                                                    </span>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}

                        {results.length === 0 && query && !loading && (
                            <div style={{ textAlign: 'center', padding: 40, color: 'var(--text-muted)' }}>
                                <Icon name="Search" style={{ width: 48, height: 48, marginBottom: 16, opacity: 0.5 }} />
                                <p>No results found. Try a different query or add more content to your library.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // Teams View Component
        function TeamsView() {
            const [teams, setTeams] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [selectedTeam, setSelectedTeam] = useState(null);
            const [newTeam, setNewTeam] = useState({ name: '', description: '' });
            const [showAddMember, setShowAddMember] = useState(false);
            const [newMember, setNewMember] = useState({ email: '', role: 'viewer' });
            // API Key state
            const [apiKeys, setApiKeys] = useState([]);
            const [showCreateApiKey, setShowCreateApiKey] = useState(false);
            const [newApiKey, setNewApiKey] = useState({ name: '', permissions: 'read', expires_days: '' });
            const [createdKey, setCreatedKey] = useState(null);

            useEffect(() => {
                loadTeams();
            }, []);

            const loadTeams = async () => {
                try {
                    const response = await fetch('/api/teams');
                    const data = await response.json();
                    setTeams(data.teams || []);
                } catch (error) {
                    console.error('Error loading teams:', error);
                } finally {
                    setLoading(false);
                }
            };

            const createTeam = async () => {
                if (!newTeam.name.trim()) return;

                try {
                    const formData = new FormData();
                    formData.append('name', newTeam.name);
                    formData.append('description', newTeam.description);

                    const response = await fetch('/api/teams', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success) {
                        loadTeams();
                        setShowCreateModal(false);
                        setNewTeam({ name: '', description: '' });
                    }
                } catch (error) {
                    console.error('Error creating team:', error);
                }
            };

            const loadTeamDetails = async (teamId) => {
                try {
                    const response = await fetch(`/api/teams/${teamId}`);
                    const data = await response.json();
                    setSelectedTeam(data);
                    loadApiKeys(teamId);
                } catch (error) {
                    console.error('Error loading team:', error);
                }
            };

            const addMember = async () => {
                if (!newMember.email.trim() || !selectedTeam) return;

                try {
                    const formData = new FormData();
                    formData.append('email', newMember.email);
                    formData.append('role', newMember.role);

                    const response = await fetch(`/api/teams/${selectedTeam.id}/members`, {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success) {
                        loadTeamDetails(selectedTeam.id);
                        setShowAddMember(false);
                        setNewMember({ email: '', role: 'viewer' });
                    }
                } catch (error) {
                    console.error('Error adding member:', error);
                }
            };

            const removeMember = async (userId) => {
                if (!confirm('Remove this member from the team?')) return;

                try {
                    await fetch(`/api/teams/${selectedTeam.id}/members/${userId}`, {
                        method: 'DELETE'
                    });
                    loadTeamDetails(selectedTeam.id);
                } catch (error) {
                    console.error('Error removing member:', error);
                }
            };

            const deleteTeam = async (teamId) => {
                if (!confirm('Delete this team? This action cannot be undone.')) return;

                try {
                    await fetch(`/api/teams/${teamId}`, { method: 'DELETE' });
                    loadTeams();
                    setSelectedTeam(null);
                } catch (error) {
                    console.error('Error deleting team:', error);
                }
            };

            // API Key functions
            const loadApiKeys = async (teamId) => {
                try {
                    const response = await fetch(`/api/teams/${teamId}/api-keys`);
                    const data = await response.json();
                    setApiKeys(data.api_keys || []);
                } catch (error) {
                    console.error('Error loading API keys:', error);
                }
            };

            const createApiKey = async () => {
                if (!newApiKey.name.trim() || !selectedTeam) return;

                try {
                    const formData = new FormData();
                    formData.append('name', newApiKey.name);
                    formData.append('permissions', newApiKey.permissions);
                    if (newApiKey.expires_days) {
                        formData.append('expires_days', newApiKey.expires_days);
                    }

                    const response = await fetch(`/api/teams/${selectedTeam.id}/api-keys`, {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.key) {
                        setCreatedKey(result);
                        loadApiKeys(selectedTeam.id);
                        setNewApiKey({ name: '', permissions: 'read', expires_days: '' });
                    }
                } catch (error) {
                    console.error('Error creating API key:', error);
                }
            };

            const revokeApiKey = async (keyId, keyName) => {
                if (!confirm(`Revoke API key "${keyName}"? This cannot be undone.`)) return;

                try {
                    await fetch(`/api/teams/${selectedTeam.id}/api-keys/${keyId}`, {
                        method: 'DELETE'
                    });
                    loadApiKeys(selectedTeam.id);
                } catch (error) {
                    console.error('Error revoking API key:', error);
                }
            };

            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    alert('Copied to clipboard!');
                } catch (error) {
                    console.error('Error copying:', error);
                }
            };

            const roleColors = {
                admin: 'red',
                contributor: 'blue',
                viewer: 'gray'
            };

            if (loading) {
                return (
                    <div style={{ padding: 40, textAlign: 'center' }}>
                        <div className="spinner"></div>
                        <p style={{ marginTop: 16 }}>Loading teams...</p>
                    </div>
                );
            }

            return (
                <div>
                    <div className="view-header">
                        <div>
                            <h1>Team Workspaces</h1>
                            <p className="text-muted">Collaborate with your team on proposals and share Company Library content</p>
                        </div>
                        <button
                            className="btn btn-primary"
                            onClick={() => setShowCreateModal(true)}
                        >
                            + Create Team
                        </button>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: selectedTeam ? '300px 1fr' : '1fr', gap: 24 }}>
                        {/* Teams List */}
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Your Teams</h3>
                            </div>
                            {teams.length === 0 ? (
                                <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-muted)' }}>
                                    <Icon name="Users" style={{ width: 48, height: 48, marginBottom: 16, opacity: 0.5 }} />
                                    <p>No teams yet</p>
                                    <p style={{ fontSize: 13, marginTop: 8 }}>Create a team to start collaborating</p>
                                </div>
                            ) : (
                                teams.map(team => (
                                    <div
                                        key={team.id}
                                        onClick={() => loadTeamDetails(team.id)}
                                        style={{
                                            padding: 16,
                                            borderBottom: '1px solid var(--border-color)',
                                            cursor: 'pointer',
                                            background: selectedTeam?.id === team.id ? 'var(--bg-tertiary)' : 'transparent'
                                        }}
                                    >
                                        <div style={{ fontWeight: 500 }}>{team.name}</div>
                                        <div style={{ fontSize: 13, color: 'var(--text-muted)', marginTop: 4 }}>
                                            {team.member_count || 0} members
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Team Details */}
                        {selectedTeam && (
                            <div className="card">
                                <div className="card-header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                    <h3 className="card-title">{selectedTeam.name}</h3>
                                    <div style={{ display: 'flex', gap: 8 }}>
                                        <button className="btn btn-primary" onClick={() => setShowAddMember(true)}>
                                            + Add Member
                                        </button>
                                        <button
                                            className="btn"
                                            style={{ color: 'var(--accent-red)' }}
                                            onClick={() => deleteTeam(selectedTeam.id)}
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </div>

                                {selectedTeam.description && (
                                    <div style={{ padding: '0 16px 16px', color: 'var(--text-secondary)', fontSize: 14 }}>
                                        {selectedTeam.description}
                                    </div>
                                )}

                                <div style={{ padding: 16, borderTop: '1px solid var(--border-color)' }}>
                                    <h4 style={{ marginBottom: 12, fontSize: 14, color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: 1 }}>
                                        Members
                                    </h4>
                                    {selectedTeam.members?.map(member => (
                                        <div
                                            key={member.id}
                                            style={{
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                alignItems: 'center',
                                                padding: 12,
                                                background: 'var(--bg-tertiary)',
                                                borderRadius: 8,
                                                marginBottom: 8
                                            }}
                                        >
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                                <div style={{
                                                    width: 36,
                                                    height: 36,
                                                    borderRadius: '50%',
                                                    background: 'var(--accent-blue)',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    color: 'white',
                                                    fontWeight: 600
                                                }}>
                                                    {member.user?.name?.charAt(0) || '?'}
                                                </div>
                                                <div>
                                                    <div style={{ fontWeight: 500 }}>{member.user?.name}</div>
                                                    <div style={{ fontSize: 12, color: 'var(--text-muted)' }}>{member.user?.email}</div>
                                                </div>
                                            </div>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                                <span className={`badge badge-${roleColors[member.role]}`}>
                                                    {member.role}
                                                </span>
                                                <button
                                                    className="btn"
                                                    style={{ padding: 4, color: 'var(--text-muted)' }}
                                                    onClick={() => removeMember(member.user_id)}
                                                >
                                                    <Icon name="X" style={{ width: 16, height: 16 }} />
                                                </button>
                                            </div>
                                        </div>
                                    ))}

                                    {(!selectedTeam.members || selectedTeam.members.length === 0) && (
                                        <div style={{ textAlign: 'center', padding: 24, color: 'var(--text-muted)' }}>
                                            No members yet. Add team members to start collaborating.
                                        </div>
                                    )}
                                </div>

                                <div style={{ padding: 16, borderTop: '1px solid var(--border-color)' }}>
                                    <h4 style={{ marginBottom: 12, fontSize: 14, color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: 1 }}>
                                        Role Permissions
                                    </h4>
                                    <div style={{ fontSize: 13 }}>
                                        <div style={{ marginBottom: 8, display: 'flex', gap: 8 }}>
                                            <span className="badge badge-red">Admin</span>
                                            <span>Full access - manage team, members, and content</span>
                                        </div>
                                        <div style={{ marginBottom: 8, display: 'flex', gap: 8 }}>
                                            <span className="badge badge-blue">Contributor</span>
                                            <span>Can add and edit library content</span>
                                        </div>
                                        <div style={{ display: 'flex', gap: 8 }}>
                                            <span className="badge badge-gray">Viewer</span>
                                            <span>Read-only access to library content</span>
                                        </div>
                                    </div>
                                </div>

                                {/* API Keys Section */}
                                <div style={{ padding: 16, borderTop: '1px solid var(--border-color)' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                                        <h4 style={{ fontSize: 14, color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: 1, margin: 0 }}>
                                            API Keys
                                        </h4>
                                        <button
                                            className="btn"
                                            style={{ fontSize: 12, padding: '4px 8px' }}
                                            onClick={() => setShowCreateApiKey(true)}
                                        >
                                            + New Key
                                        </button>
                                    </div>

                                    {apiKeys.length === 0 ? (
                                        <div style={{ textAlign: 'center', padding: 16, color: 'var(--text-muted)', fontSize: 13 }}>
                                            <Icon name="Key" style={{ width: 24, height: 24, marginBottom: 8, opacity: 0.5 }} />
                                            <p>No API keys yet</p>
                                            <p style={{ fontSize: 12 }}>Create keys for programmatic access</p>
                                        </div>
                                    ) : (
                                        apiKeys.map(key => (
                                            <div
                                                key={key.id}
                                                style={{
                                                    padding: 12,
                                                    background: 'var(--bg-tertiary)',
                                                    borderRadius: 8,
                                                    marginBottom: 8
                                                }}
                                            >
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                                                    <div>
                                                        <div style={{ fontWeight: 500, marginBottom: 4 }}>{key.name}</div>
                                                        <div style={{ fontSize: 12, color: 'var(--text-muted)', fontFamily: 'monospace' }}>
                                                            {key.key_prefix}...
                                                        </div>
                                                        <div style={{ fontSize: 11, color: 'var(--text-muted)', marginTop: 4 }}>
                                                            {key.permissions?.join(', ') || 'read'}
                                                            {key.is_expired && <span style={{ color: 'var(--accent-red)', marginLeft: 8 }}>Expired</span>}
                                                            {key.last_used && <span style={{ marginLeft: 8 }}>Last used: {new Date(key.last_used).toLocaleDateString()}</span>}
                                                        </div>
                                                    </div>
                                                    <button
                                                        className="btn"
                                                        style={{ padding: 4, color: 'var(--accent-red)' }}
                                                        onClick={() => revokeApiKey(key.id, key.name)}
                                                        title="Revoke key"
                                                    >
                                                        <Icon name="Trash2" style={{ width: 14, height: 14 }} />
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Create Team Modal */}
                    {showCreateModal && (
                        <div className="modal-overlay" onClick={() => setShowCreateModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h3 style={{ marginBottom: 16 }}>Create New Team</h3>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Team Name</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="e.g., Proposal Team Alpha"
                                        value={newTeam.name}
                                        onChange={(e) => setNewTeam(prev => ({ ...prev, name: e.target.value }))}
                                    />
                                </div>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Description (optional)</label>
                                    <textarea
                                        className="form-input"
                                        placeholder="Describe the team's purpose..."
                                        value={newTeam.description}
                                        onChange={(e) => setNewTeam(prev => ({ ...prev, description: e.target.value }))}
                                        rows={3}
                                    />
                                </div>
                                <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>
                                    <button className="btn" onClick={() => setShowCreateModal(false)}>Cancel</button>
                                    <button className="btn btn-primary" onClick={createTeam}>Create Team</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Member Modal */}
                    {showAddMember && (
                        <div className="modal-overlay" onClick={() => setShowAddMember(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h3 style={{ marginBottom: 16 }}>Add Team Member</h3>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Email Address</label>
                                    <input
                                        type="email"
                                        className="form-input"
                                        placeholder="colleague@company.com"
                                        value={newMember.email}
                                        onChange={(e) => setNewMember(prev => ({ ...prev, email: e.target.value }))}
                                    />
                                </div>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Role</label>
                                    <select
                                        className="form-input"
                                        value={newMember.role}
                                        onChange={(e) => setNewMember(prev => ({ ...prev, role: e.target.value }))}
                                    >
                                        <option value="viewer">Viewer - Read only access</option>
                                        <option value="contributor">Contributor - Can add content</option>
                                        <option value="admin">Admin - Full access</option>
                                    </select>
                                </div>
                                <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>
                                    <button className="btn" onClick={() => setShowAddMember(false)}>Cancel</button>
                                    <button className="btn btn-primary" onClick={addMember}>Add Member</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Create API Key Modal */}
                    {showCreateApiKey && (
                        <div className="modal-overlay" onClick={() => setShowCreateApiKey(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h3 style={{ marginBottom: 16 }}>Create API Key</h3>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Key Name</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="e.g., CI/CD Pipeline"
                                        value={newApiKey.name}
                                        onChange={(e) => setNewApiKey(prev => ({ ...prev, name: e.target.value }))}
                                    />
                                </div>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Permissions</label>
                                    <select
                                        className="form-input"
                                        value={newApiKey.permissions}
                                        onChange={(e) => setNewApiKey(prev => ({ ...prev, permissions: e.target.value }))}
                                    >
                                        <option value="read">Read - View data only</option>
                                        <option value="read,write">Read & Write - Modify data</option>
                                        <option value="read,write,admin">Full Access - All permissions</option>
                                    </select>
                                </div>
                                <div style={{ marginBottom: 16 }}>
                                    <label style={{ display: 'block', marginBottom: 4, fontSize: 13 }}>Expiration (optional)</label>
                                    <select
                                        className="form-input"
                                        value={newApiKey.expires_days}
                                        onChange={(e) => setNewApiKey(prev => ({ ...prev, expires_days: e.target.value }))}
                                    >
                                        <option value="">Never expires</option>
                                        <option value="30">30 days</option>
                                        <option value="90">90 days</option>
                                        <option value="180">180 days</option>
                                        <option value="365">1 year</option>
                                    </select>
                                </div>
                                <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>
                                    <button className="btn" onClick={() => setShowCreateApiKey(false)}>Cancel</button>
                                    <button className="btn btn-primary" onClick={createApiKey}>Create Key</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Created API Key Display Modal */}
                    {createdKey && (
                        <div className="modal-overlay" onClick={() => setCreatedKey(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()} style={{ maxWidth: 500 }}>
                                <div style={{ textAlign: 'center', marginBottom: 16 }}>
                                    <div style={{
                                        width: 48,
                                        height: 48,
                                        borderRadius: '50%',
                                        background: 'var(--accent-green)',
                                        display: 'inline-flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        marginBottom: 12
                                    }}>
                                        <Icon name="Check" style={{ width: 24, height: 24, color: 'white' }} />
                                    </div>
                                    <h3>API Key Created</h3>
                                </div>

                                <div style={{
                                    background: 'var(--bg-tertiary)',
                                    padding: 16,
                                    borderRadius: 8,
                                    marginBottom: 16
                                }}>
                                    <div style={{ fontSize: 12, color: 'var(--text-muted)', marginBottom: 4 }}>Your API Key</div>
                                    <div style={{
                                        fontFamily: 'monospace',
                                        fontSize: 13,
                                        wordBreak: 'break-all',
                                        background: 'var(--bg-primary)',
                                        padding: 12,
                                        borderRadius: 4,
                                        marginBottom: 8
                                    }}>
                                        {createdKey.key}
                                    </div>
                                    <button
                                        className="btn btn-primary"
                                        style={{ width: '100%' }}
                                        onClick={() => copyToClipboard(createdKey.key)}
                                    >
                                        <Icon name="Copy" style={{ width: 14, height: 14, marginRight: 8 }} />
                                        Copy to Clipboard
                                    </button>
                                </div>

                                <div style={{
                                    background: 'rgba(251, 191, 36, 0.1)',
                                    border: '1px solid var(--accent-amber)',
                                    padding: 12,
                                    borderRadius: 8,
                                    marginBottom: 16,
                                    fontSize: 13
                                }}>
                                    <strong style={{ color: 'var(--accent-amber)' }}>Important:</strong> This key will only be shown once.
                                    Store it securely - you won't be able to see it again.
                                </div>

                                <div style={{ fontSize: 13, color: 'var(--text-muted)' }}>
                                    <div><strong>Name:</strong> {createdKey.name}</div>
                                    <div><strong>Permissions:</strong> {createdKey.permissions?.join(', ')}</div>
                                    {createdKey.expires_at && (
                                        <div><strong>Expires:</strong> {new Date(createdKey.expires_at).toLocaleDateString()}</div>
                                    )}
                                </div>

                                <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 16 }}>
                                    <button className="btn btn-primary" onClick={() => { setCreatedKey(null); setShowCreateApiKey(false); }}>
                                        Done
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Helpers
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        function getTypeBadgeColor(type) {
            const colors = {
                performance: 'blue',
                compliance: 'purple',
                technical: 'green',
                deliverable: 'amber',
                prohibition: 'red',
                evaluation: 'purple',
                proposal_instruction: 'gray',
                labor_requirement: 'amber'
            };
            return colors[type] || 'gray';
        }
        
        // Render
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
